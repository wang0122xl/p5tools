var it=Object.defineProperty,st=Object.defineProperties;var rt=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var at=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var W=(s,t,o)=>t in s?it(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o,v=(s,t)=>{for(var o in t||(t={}))at.call(t,o)&&W(s,o,t[o]);if(Z)for(var o of Z(t))lt.call(t,o)&&W(s,o,t[o]);return s},M=(s,t)=>st(s,rt(t));var r=(s,t,o)=>(W(s,typeof t!="symbol"?t+"":t,o),o);import{e as ct,R as L,j as u,r as P,a as x,C as ut,F as q,h as R,b as ht,P as dt,_ as gt,c as ft}from"./vendor.49e52eed.js";const mt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}};mt();function O(s,t){const o=Math.pow(t[0]-s[0],2)+Math.pow(t[1]-s[1],2);return Math.pow(o,1/2)}function pt(s,t,o){const e=Math.atan2(s[1]-t[1],s[0]-t[0]);return o!=="DEGREES"?e:180/Math.PI*e}function At(s,t,o){return new Promise(e=>{s.toBlob(n=>{e(n)},t,o)})}const G="EMITTER_PLUGIN_ACTIVED",H="EMITTER_ANNOTATION_INFO_UPDATED",z="EMITTER_ANNOTATION_INFO_UPDATED";var b=new ct.exports.EventEmitter;class F{constructor(t,o,e){r(this,"annotations",[]);r(this,"name");r(this,"editingAnnotation");r(this,"options");r(this,"pluginsCount",0);r(this,"pluginItemWH",20);r(this,"pluginItemMargin",5);r(this,"state");r(this,"scale",1);r(this,"translateX",0);r(this,"translateY",0);r(this,"getToolInfo",()=>Promise.resolve({time:new Date().getTime()}));r(this,"transformValue",t=>t*this.scale);r(this,"transformPoint",t=>[this.transformValue(t[0])+this.translateX,this.transformValue(t[1])+this.translateY]);r(this,"restorePoint",t=>[(t[0]-this.translateX)/this.scale,(t[1]-this.translateY)/this.scale]);this.name=t,o&&(this.annotations=o),this.state=e||{}}configAnnotation(t,o){const e=o.options;if(e==null?void 0:e.strokeColor){const n=t.color(e.strokeColor),i=t.map(e.strokeAlpha||1,0,1,0,255);n.setAlpha(i),t.stroke(n)}else t.noStroke();(e==null?void 0:e.fillColor)?t.fill(e.fillColor):t.noFill(),(e==null?void 0:e.textSize)&&t.textSize(e.textSize*this.scale),(e==null?void 0:e.strokeWeight)&&t.strokeWeight(e.strokeWeight*this.scale),(e==null?void 0:e.textStyle)&&t.textStyle(e.textStyle)}getInitialOptions(){return{textSize:12,strokeColor:"#111",strokeWeight:1}}getInitialAnnotation(){const t=this;return{info:{time:new Date().getTime()},remove:function(){t.annotations.splice(t.annotations.indexOf(this),1)},belong:this.name,options:v(v({},this.getInitialOptions()),this.options),translateX:0,translateY:0,scale:1,transformedStartPoint:function(){if(!!this.startPoint)return[t.transformValue(this.startPoint[0]+this.translateX)+t.translateX,t.transformValue(this.startPoint[1]+this.translateY)+t.translateY]},transformedEndPoint:function(){if(!!this.endPoint)return[t.transformValue(this.endPoint[0]+this.translateX)+t.translateX,t.transformValue(this.endPoint[1]+this.translateY)+t.translateY]}}}validateAnnotation(t){return!(O(t.startPoint,t.endPoint)<2)}preload(t){}setup(t){}mouseMoved(t){}draw(t){}touchStarted(t){this.editingAnnotation=M(v({},this.getInitialAnnotation()),{startPoint:this.restorePoint([t.mouseX,t.mouseY])}),this.annotations.push(this.editingAnnotation)}touchMoved(t){this.editingAnnotation.endPoint=this.restorePoint([t.mouseX,t.mouseY])}touchEnded(t){var o;this.editingAnnotation.endPoint=this.restorePoint([t.mouseX,t.mouseY]),this.validateAnnotation(this.editingAnnotation)?this.getToolInfo(this).then(e=>{this.editingAnnotation&&(this.editingAnnotation.info=e,b.emit(H))}).catch(e=>{console.warn(e)}):((o=this.annotations)==null||o.pop(),this.editingAnnotation=void 0)}reverseStartEndPointByOrder(){if(this.editingAnnotation&&this.editingAnnotation.startPoint&&this.editingAnnotation.endPoint){const[t,o]=this.editingAnnotation.startPoint,[e,n]=this.editingAnnotation.endPoint;this.editingAnnotation.startPoint=[Math.min(t,e),Math.min(o,n)],this.editingAnnotation.endPoint=[Math.max(t,e),Math.max(o,n)]}}pointInAnnotation(t,o){return!1}getPluginOrigin(t){return t.startPoint||[0,0]}pointInPluginLayer(t,o){const e=this.getPluginOrigin(o);return t[0]>e[0]&&t[0]<e[0]+(this.pluginItemWH+this.pluginItemMargin)*this.pluginsCount&&t[1]>e[1]&&t[1]<e[1]+this.pluginItemWH}}r(F,"toolName");class Q extends F{constructor(t){super("CircleTool",t)}getPluginOrigin(t){const o=t.transformedStartPoint(),e=t.transformedEndPoint();if(o&&e){const n=O(o,e);return[o[0]+n+(t.options.strokeWeight||1)*this.scale/2,o[1]-this.pluginItemWH/2]}return[0,0]}pointInAnnotation(t,o){const e=o.transformedStartPoint(),n=o.transformedEndPoint();if(!e||!n)return!1;const i=O(e,n);return O(e,t)<i?!0:this.pointInPluginLayer(t,o)}touchEnded(t){if(super.touchEnded(t),this.editingAnnotation){const[o,e]=this.editingAnnotation.startPoint,n=O(this.editingAnnotation.startPoint,this.editingAnnotation.endPoint);this.editingAnnotation.endPoint=[o+n,e]}}draw(t){for(const o of this.annotations||[]){const e=o.transformedStartPoint(),n=o.transformedEndPoint();if(!e||!n)return;super.configAnnotation(t,o),t.circle(e[0],e[1],O(e,n)*2)}}}r(Q,"toolName","CircleTool");class j extends F{constructor(t){super("SquareTool",t)}getPluginOrigin(t){const o=t.transformedStartPoint(),e=t.transformedEndPoint();if(!e||!o)return[0,0];const n=[o[0],e[0]],i=[o[1],e[1]];return[Math.max(...n)+(t.options.strokeWeight||1)*this.scale,Math.max(...i)-this.pluginItemWH+(t.options.strokeWeight||1)*this.scale/2]}touchEnded(t){super.touchEnded(t),this.reverseStartEndPointByOrder()}pointInAnnotation(t,o){const e=o.transformedStartPoint(),n=o.transformedEndPoint();if(!n||!e)return!1;const i=[e[0],n[0]],a=[e[1],n[1]];return t[0]<Math.max(...i)&&t[0]>Math.min(...i)&&t[1]<Math.max(...a)&&t[1]>Math.min(...a)?!0:this.pointInPluginLayer(t,o)}draw(t){for(const o of this.annotations||[]){const e=o.transformedStartPoint(),n=o.transformedEndPoint();if(!e||!n)return;super.configAnnotation(t,o),t.quad(e[0],e[1],n[0],e[1],n[0],n[1],e[0],n[1])}}}r(j,"toolName","SquareTool");class J extends F{constructor(t){super("LineTool",t)}draw(t){for(const o of this.annotations||[]){const e=o.transformedStartPoint(),n=o.transformedEndPoint();if(!e||!n)return;super.configAnnotation(t,o),t.line(e[0],e[1],n[0],n[1])}}}r(J,"toolName","LineTool");class K extends F{constructor(t){super("ArrowLineTool",t);this.getToolInfo=()=>{const o=prompt("\u8BF7\u8F93\u5165")||"";return Promise.resolve({title:o,time:new Date().getTime()})}}draw(t){var o;for(const e of this.annotations||[]){const n=e.transformedStartPoint(),i=e.transformedEndPoint();if(!n||!i)return;t.angleMode("degrees");const a=pt(n,i,"DEGREES"),c=(((o=e.options)==null?void 0:o.strokeWeight)||1)*8,m=[n[0]+c*t.cos(a-145)*this.scale,n[1]+c*t.sin(a-145)*this.scale],g=[n[0]+c*t.cos(a+145)*this.scale,n[1]+c*t.sin(a+145)*this.scale];super.configAnnotation(t,e),t.line(n[0],n[1],i[0],i[1]),t.line(n[0],n[1],m[0],m[1]),t.line(n[0],n[1],g[0],g[1]),t.noStroke(),t.textSize(e.options.textSize*this.scale),t.fill(e.options.strokeColor),t.text(e.info.title||"",n[0]+5*t.cos(a)/4,n[1]+5*t.sin(a)/4+.8*(a>0?t.textAscent():-t.textAscent()*.5))}}}r(K,"toolName","ArrowLineTool");class $ extends F{constructor(t){super("FreehandTool",t)}getInitialAnnotation(){return M(v({},super.getInitialAnnotation()),{belong:"FreehandTool",freePaths:[]})}touchMoved(t){var n,i,a;const o=((n=this.editingAnnotation)==null?void 0:n.freePaths[this.editingAnnotation.freePaths.length-1])||((i=this.editingAnnotation)==null?void 0:i.startPoint),e=this.restorePoint([t.mouseX,t.mouseY]);o&&e&&O(o,e)>4&&((a=this.editingAnnotation)==null||a.freePaths.push(e))}draw(t){for(const o of this.annotations||[]){const e=o.startPoint,n=o.endPoint,i=[e,...o.freePaths,n];super.configAnnotation(t,o);for(let a=0;a<i.length-1;a++){const c=i[a],m=i[a+1];if(!m)break;const g=this.transformPoint(c),p=this.transformPoint(m);t.line(g[0],g[1],p[0],p[1])}}}}r($,"toolName","FreehandTool");class k extends F{constructor(t){super("TextTool",t);this.getToolInfo=()=>{const o=prompt("\u8BF7\u8F93\u5165")||"";return Promise.resolve({title:o,time:new Date().getTime()})}}validateAnnotation(t){return!0}touchEnded(t){super.touchEnded(t),this.editingAnnotation&&(this.editingAnnotation.startPoint=this.restorePoint([t.mouseX,t.mouseY]))}getPluginOrigin(t){const o=t.transformedStartPoint();return o?[o[0]-t.textWidth/2,o[1]-this.pluginItemWH-t.textHeight]:[0,0]}pointInAnnotation(t,o){const e=o.transformedStartPoint();if(!e)return!1;const n=o.textWidth/2;return t[0]>e[0]-n&&t[0]<e[0]+n&&t[1]>e[1]-o.textHeight&&t[1]<e[1]?!0:this.pointInPluginLayer(t,o)}draw(t){for(const o of this.annotations||[]){const e=o.transformedStartPoint();if(!e)return;super.configAnnotation(t,o),t.noStroke();const n=o.info.title||"",i=t.textWidth(n);o.textWidth=i;const a=t.textAscent();o.textHeight=a,t.text(n,e[0]-i/2,e[1])}}}r(k,"toolName","TextTool");const Pt={top:"ns-resize","top-right":"nesw-resize","top-left":"nwse-resize",left:"ew-resize",right:"ew-resize","in-rect":"MOVE","out-rect":"default",bottom:"ns-resize","bottom-left":"nesw-resize","bottom-right":"nwse-resize"},A=6,_=(s,t,o)=>{let e="out-rect";if(!t||!o)return"out-rect";const[n,i]=s,a=Math.min(t[0],o[0]),c=Math.max(t[0],o[0]),m=Math.min(t[1],o[1]),g=Math.max(t[1],o[1]),p=n>a-A&&n<a+A,f=i>m-A&&i<m+A,E=n>c-A&&n<c+A,S=i>g-A&&i<g+A;return n>a+A&&n<c-A&&i>m+A&&i<g-A?e="in-rect":f?(e="top",p?e="top-left":E&&(e="top-right")):S?(e="bottom",p?e="bottom-left":E&&(e="bottom-right")):p?e="left":E?e="right":e="out-rect",e};class tt extends F{constructor(t,o){super("CropTool",t);r(this,"cursorPosition","out-rect");r(this,"touchStartPoint",[0,0]);r(this,"images",[]);r(this,"pg");r(this,"startRect");r(this,"endRect");this.state.cropedImages=o||[]}endCrop(){var t;(t=this.editingAnnotation)==null||delete t.startPoint,this.annotations=[]}async doCrop(t,o,e){const n=this.annotations[0],[i,a]=n.transformedStartPoint(),[c,m]=n.transformedEndPoint(),g=t.get();t.noLoop(),t.clear(),await(o==null?void 0:o(t)),t.image(g,0,0,t.width,t.height),await(e==null?void 0:e(t));const p=t.get(i+A/2,a+A/2,c-i-A,m-a-A).canvas,f=await At(p);if(f){const E=URL.createObjectURL(f),S=await this.getToolInfo(this);this==null||this.images.push({info:S,url:E}),b.emit(z),t.loop()}this.endCrop()}touchStarted(t){var i,a,c;const o=(i=this.editingAnnotation)==null?void 0:i.startPoint,e=(a=this.editingAnnotation)==null?void 0:a.endPoint,n=this.restorePoint([t.mouseX,t.mouseY]);this.cursorPosition=_(n,o,e),this.cursorPosition==="out-rect"&&(this.editingAnnotation=M(v({},this.getInitialAnnotation()),{belong:"CropTool",startPoint:n}),this.annotations=[this.editingAnnotation],(c=this.startRect)==null||c.call(this,{startX:n[0],startY:n[1]})),this.touchStartPoint=[t.mouseX,t.mouseY]}touchMoved(t){const o=this.editingAnnotation,e=this.restorePoint([t.mouseX,t.mouseY]);this.cursorPosition==="out-rect"&&(o.endPoint=e);const n=o.startPoint,i=o.endPoint;let a=n[0],c=n[1],m=i[0],g=i[1];const p=(t.mouseX-this.touchStartPoint[0])/this.scale,f=(t.mouseY-this.touchStartPoint[1])/this.scale;switch(this.cursorPosition){case"in-rect":a+=p,c+=f,m+=p,g+=f;break;case"top":c+=f;break;case"bottom":g+=f;break;case"left":a+=p;break;case"right":m+=p;break;case"top-left":a+=p,c+=f;break;case"top-right":m+=p,c+=f;break;case"bottom-left":a+=p,g+=f;break;case"bottom-right":m+=p,g+=f;break}o.startPoint=[a,c],o.endPoint=[m,g],this.touchStartPoint=[t.mouseX,t.mouseY],this.doEndRect()}doEndRect(){var e,n;if(!((e=this.editingAnnotation)==null?void 0:e.startPoint)||!this.editingAnnotation.endPoint)return;const t=this.editingAnnotation.transformedStartPoint(),o=this.editingAnnotation.transformedEndPoint();(n=this.endRect)==null||n.call(this,{startX:Math.min(t[0],o[0]),startY:Math.min(t[1],o[1]),endX:Math.max(t[0],o[0]),endY:Math.max(t[1],o[1])})}touchEnded(t){this.editingAnnotation&&this.reverseStartEndPointByOrder()}drawCropArea(t,o,e,n){if(!this.pg)return;const i=this.editingAnnotation;this.pg.erase(),this.pg.quad(t+i.translateX+1,o+i.translateY+1,e+i.translateX-1,o+i.translateY+1,e+i.translateX-1,n+i.translateY-1,t+i.translateX+1,n+i.translateY-1),this.pg.noErase()}draw(t){var f,E,S,N,X;if(this.pg||(this.pg=t.createGraphics(t.width,t.height)),t.width!==this.pg.width||t.height!==this.pg.height?(this.pg.resizeCanvas(t.width,t.height),this.doEndRect()):(f=this.pg)==null||f.clear(),this.pg.background(0,0,0,120),!this.editingAnnotation)return;const o=this.editingAnnotation,e=o.transformedStartPoint(),n=o.transformedEndPoint();if(!e||!n)return;const i=Math.min(e[0],n[0]),a=Math.min(e[1],n[1]),c=Math.max(e[0],n[0]),m=Math.max(e[1],n[1]),g=_(this.restorePoint([t.mouseX,t.mouseY]),o.startPoint,o.endPoint);g==="out-rect"?t.cursor(t.CROSS):t.cursor(Pt[g]),this.pg.stroke(o.options.strokeColor),(E=this.pg)==null||E.stroke(o.options.strokeColor),(S=this.pg)==null||S.strokeWeight(1),this.pg.fill(255,255,255,255),(N=this.pg)==null||N.quad(i,a,c,a,c,m,i,m),this.drawCropArea(i,a,c,m);const p=[[i,a],[i,m],[c,a],[c,m]];(X=this.pg)==null||X.fill(o.options.strokeColor),p.forEach(([I,l])=>{var T;(T=this.pg)==null||T.quad(I-A/2,l-A/2,I+A/2,l-A/2,I+A/2,l+A/2,I-A/2,l+A/2)}),t.image(this.pg,0,0,t.width,t.height)}}r(tt,"toolName","CropTool");class U{constructor(t){r(this,"name","");r(this,"tools",[]);r(this,"enabled",!1);r(this,"active",!1);r(this,"iconUrl");r(this,"icon");r(this,"totalPluginsCount",0);r(this,"pluginIndex",0);r(this,"pluginItemWH",20);r(this,"pluginItemMargin",5);r(this,"touchStartPoint");r(this,"touchEndPoint",[0,0]);r(this,"editingAnnotation");r(this,"pluginLayerOrigin");r(this,"scale",1);r(this,"translateX",0);r(this,"translateY",0);this.iconUrl=t,b.on(G,o=>{o!==this.name&&(this.active=!1)})}preload(t){t.loadImage(this.iconUrl,o=>{this.icon=o})}draw(t){if(!!this.enabled){for(const o of this.tools)for(const e of o.annotations)if(o.pointInAnnotation([t.mouseX,t.mouseY],e)){if(!e.startPoint)continue;this.pluginLayerOrigin=o.getPluginOrigin(e);const n=this.pluginLayerOrigin[0]+(this.pluginItemWH+this.pluginItemMargin)*this.pluginIndex;t.noStroke(),t.fill("#ffffff"),t.rect(n,this.pluginLayerOrigin[1],this.pluginItemWH,this.pluginItemWH),t.image(this.icon,n,this.pluginLayerOrigin[1],this.pluginItemWH,this.pluginItemWH)}}}touchStarted(t){for(const o of this.tools)for(const e of o.annotations){const n=o.getPluginOrigin(e),i=n[0]+(this.pluginItemWH+this.pluginItemMargin)*this.pluginIndex,a=n[1];if(t.mouseX>i&&t.mouseX<i+this.pluginItemWH&&t.mouseY>a&&t.mouseY<a+this.pluginItemWH){this.active=!0,this.editingAnnotation=e,o.getPluginOrigin(e),this.touchStartPoint=[t.mouseX,t.mouseY],b.emit(G,this.name);return}}}touchMoved(t){this.touchEndPoint=[t.mouseX,t.mouseY],this.handleTouchMoved(t)}touchEnded(t){this.active=!1}handleTouchMoved(t){}}r(U,"pluginName");const xt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAARVJREFUSEvFlsENwjAMRX/lbegE3JiiEzCApQ4ADFDJM3DsFJy4cYRhkCxQqga1IU0MKCKnHhw/2/8naQXjatt2papHAHci2nZdd7NsrSxBY/IeQD3GX4mosUCygEhyX5MJkgQEya/TDsbvLCQJYOY9gB2AIZGqOgiIqFZVP7KDiLi46MoBNgA2RNS7eTPzw2URkWrsrgFwEpHTV4Bw0xRgMYeLmXWQqyoFYOZZt76AFyAQNDrXDGCml7fwAAjdsuTxFGAphxfLOyJpu5wGMUjFzGcAa6toH8ZdygOs83eVfzWi4iL7mRa1aQBZPP4/HTSLO3IaxHL897Irfl0Xf3AiFp6OOfuavV3XS0IXffQDC3/82/IEL+oxZnXZjqwAAAAASUVORK5CYII=";class Tt extends U{constructor(){super(xt);this.name="MovePlugin"}handleTouchMoved(t){!this.editingAnnotation||(this.editingAnnotation.translateX=(this.touchEndPoint[0]-this.touchStartPoint[0])/this.scale+this.editingAnnotation.translateX,this.editingAnnotation.translateY=(this.touchEndPoint[1]-this.touchStartPoint[1])/this.scale+this.editingAnnotation.translateY,this.touchStartPoint=[t.mouseX,t.mouseY])}}const Et="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAATtJREFUSEvllT1OxDAQhZ/jG3AMKLeiS0cD7VacIRklB2BzgESTgoaeZltoqNhuT7AcgQaJGzhBjmJkjEHZSahwl8gz3/y9scIfH+X8Z1m2SpLkKsbr+37ftu2TJJYBQEQpgOffHDDzZzDHgBxgA+AmMKzc9xIZhIA3rXVa1/XLMdHG7sYyeAdwAuCgtV7PhYSASmu9NcZsAZwtAfkGYOZNWZanS0GiAFvLAFJZsKQfA6Aoisuu6x6sDpqmeXSORsgawI6Zd2KAxHCqjUg8U53be/8YMO6v1OrGF+M4GAc3MOISEZFbL18UT0R2adrlOYy2GPCTGBcDRMQ4ZGKMuV0kg0CMbnf5EzyvRL4n19jwPZnVg3GK/EfKNtY/18x8L24yEfVTnlgxIM/zC6XUeQTyysx37r8YMHUffQC+w6kZYxwPvQAAAABJRU5ErkJggg==";class Ct extends U{constructor(){super(Et);this.name="ScalePlugin"}handleTouchMoved(t){if(!this.editingAnnotation)return;const[o,e]=this.editingAnnotation.endPoint,[n,i]=this.editingAnnotation.startPoint,a=o+(this.touchEndPoint[0]-this.touchStartPoint[0])/this.scale;let c=e+(this.touchEndPoint[1]-this.touchStartPoint[1])/this.scale;this.editingAnnotation.belong==="CircleTool"&&(c=i),this.editingAnnotation.startPoint=[Math.min(n,a),Math.min(i,c)],this.editingAnnotation.endPoint=[Math.max(n,a),Math.max(i,c)],this.touchStartPoint=[t.mouseX,t.mouseY]}}class h{constructor(){r(this,"tools",[]);r(this,"plugins",[]);r(this,"_toolsMapping",{});r(this,"touchStatus","end");r(this,"hasEnabledToolCallback");r(this,"_enabledTool");this.tools=[],this._toolsMapping={}}set enabledTool(t){var o;this._enabledTool=t,(o=this.hasEnabledToolCallback)==null||o.call(this,!!t);for(const e of this.plugins)e.enabled=!t}get enabledTool(){return this._enabledTool}useTool(t,o){return this.findTool(t.name)?(console.error("tool: %s\u5DF2\u5B58\u5728, \u8BF7\u52FF\u91CD\u590D\u6DFB\u52A0"),this):(this._toolsMapping[t.name]=t,t.getToolInfo=o||t.getToolInfo,this.tools.push(t),this)}usePlugin(t,o){let e=!1;for(const n of this.plugins)if(t.name===n.name){e=!0;break}e?console.error("%s\u5DF2\u5B58\u5728, \u8BF7\u52FF\u91CD\u590D\u6DFB\u52A0",t.name):(t.tools=o,this.plugins.push(t));for(let n=0;n<this.plugins.length;n++){const i=this.plugins[n];i.totalPluginsCount=this.plugins.length,i.pluginIndex=n}for(const n of this.tools)n.pluginsCount=this.plugins.length;return this}setup(t){for(const o of this.tools)o.setup(t)}preload(t){for(const o of this.tools)o.preload(t);for(const o of this.plugins)o.preload(t)}draw(t,o,e,n){for(const i of this.tools)i.scale=o||1,i.translateX=e||0,i.translateY=n||0,i.draw(t);for(const i of this.plugins)i.scale=o||1,i.translateX=e||0,i.translateY=n||0,i.draw(t)}mouseMoved(t){}touchStarted(t){var o;this.touchStatus="start",(o=this.enabledTool)==null||o.touchStarted(t);for(const e of this.plugins)e.touchStarted(t)}touchMoved(t){var o;this.touchStatus="moving",(o=this.enabledTool)==null||o.touchMoved(t);for(const e of this.plugins)e.active&&e.touchMoved(t)}touchEnded(t){var o;this.touchStatus="end",(o=this.enabledTool)==null||o.touchEnded(t);for(const e of this.plugins)e.active&&e.touchEnded(t)}findTool(t){return this._toolsMapping[t]}setToolEnabled(t,o){const e=this.findTool(t);e?(e.options=o,this.enabledTool=e):console.error("\u672A\u8BBE\u7F6Etool\uFF1A%s",t)}quitTool(){this.enabledTool=void 0}getAllAnnotations(){let t=[];for(const o of this.tools)for(const e of o.annotations)t.push(e);return t}}r(h,"CircleTool",Q),r(h,"SquareTool",j),r(h,"LineTool",J),r(h,"FreehandTool",$),r(h,"TextTool",k),r(h,"ArrowLineTool",K),r(h,"CropTool",tt),r(h,"MovePlugin",Tt),r(h,"ScalePlugin",Ct);const St=s=>{const[t,o]=P.exports.useState("2"),[e,n]=P.exports.useState("1"),[i,a]=P.exports.useState("#f44336");return x("div",{className:"options",style:{top:s.rect.top,left:s.rect.left-290},children:[u("p",{children:"\u753B\u7B14\u7C97\u7EC6\uFF1A"}),u("input",{value:t,onChange:c=>o(c.target.value)}),u("p",{children:"\u900F\u660E\u5EA6\uFF1A"}),u("input",{value:e,onChange:c=>n(c.target.value)}),u("div",{children:u(ut,{color:i,onChange:c=>a(c.hex)})}),x("div",{className:"flex items-center mt-20px",children:[u("button",{className:"flex-1 mr-10px",onClick:()=>{s.onConfirm({width:parseFloat(t)||2,alpha:parseFloat(e)||1,color:i})},children:"\u786E\u8BA4"}),u("button",{className:"flex-1",onClick:s.onCancel,children:"\u53D6\u6D88"})]})]})},wt=s=>{const t=s.target.getBoundingClientRect();return new Promise((o,e)=>{let n=document.createElement("div");n.style.position="fixed",n.style.left="0",n.style.right="0",n.style.bottom="0",n.style.top="0",document.body.appendChild(n);const i=()=>{L.unmountComponentAtNode(n),document.body.removeChild(n),n=null};L.render(u(St,{rect:t,onCancel:()=>{i(),e()},onConfirm:a=>{i(),o(a)}}),n)})};const vt=s=>{const[t,o]=P.exports.useState(s.info);return x("div",{className:"w-250px bg-white flex flex-col p-20px children:my-5px",children:[u("p",{children:"\u6807\u9898: "}),u("input",{value:(t==null?void 0:t.title)||"",onChange:e=>o(M(v({},t),{title:e.target.value}))}),u("p",{children:"\u5907\u6CE8: "}),u("input",{value:(t==null?void 0:t.remark)||"",onChange:e=>o(M(v({},t),{remark:e.target.value}))}),u("p",{children:"\u5176\u4ED6\u4FE1\u606F: "}),u("input",{value:(t==null?void 0:t.others)||"",onChange:e=>o(M(v({},t),{others:e.target.value}))}),x("div",{className:"flex items-center mt-20px",children:[u("button",{className:"flex-1 mr-10px",onClick:()=>{s.onConfirm(M(v({},t),{time:new Date().getTime()}))},children:"\u786E\u8BA4"}),u("button",{className:"flex-1",onClick:s.onCancel,children:"\u53D6\u6D88"})]})]})},et=s=>new Promise(t=>{let o=document.createElement("div");o.style.position="fixed",o.style.left="0",o.style.right="0",o.style.bottom="0",o.style.top="0",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",document.body.appendChild(o);const e=()=>{L.unmountComponentAtNode(o),document.body.removeChild(o),o=null};L.render(u(vt,{info:s,onCancel:()=>{e(),t(!1)},onConfirm:n=>{e(),t(n)}}),o)}),It=s=>{const[t,o]=P.exports.useState(!0),[e,n]=P.exports.useState([]),[i,a]=P.exports.useState(!1),[c,m]=P.exports.useState([]),g=(l,T)=>{const Y=R(l.info.time),w=R(T.info.time);return Y.isAfter(w)?-1:1},p=()=>{const l=s.manager.getAllAnnotations().sort(g);n(l)},f=()=>{const T=s.manager.findTool(h.CropTool.toolName).images.sort(g);m([...T])};P.exports.useEffect(()=>(b.on(H,p),b.on(z,f),()=>{b.removeListener(H,p),b.removeListener(z,f)}),[]);const E=async(l,T)=>{var Y;try{const w=await wt(l);(Y=s.sk)==null||Y.cursor(s.sk.ARROW),T===h.TextTool.toolName?s.manager.setToolEnabled(T,{fillColor:w.color,strokeAlpha:w.alpha,textSize:w.width}):s.manager.setToolEnabled(T,{strokeColor:w.color,strokeAlpha:w.alpha,strokeWeight:w.width})}catch{s.manager.quitTool()}},S=()=>{var l;(l=s.sk)==null||l.cursor(s.sk.CROSS),s.manager.setToolEnabled(h.CropTool.toolName,{strokeColor:"blue"})},N=async l=>{const T=await et(l.info);T&&(l.info=T,p())},X=l=>{l.remove(),p()},I=l=>{const T=s.manager.findTool(h.CropTool.toolName),Y=T.images.indexOf(l);T.images.splice(Y,1),f()};return x(q,{children:[x("div",{className:"common-pannel pannel",children:[u("p",{onClick:l=>E(l,h.CircleTool.toolName),children:"\u5706\u5F62"}),u("p",{onClick:l=>E(l,h.SquareTool.toolName),children:"\u65B9\u5F62"}),u("p",{onClick:l=>E(l,h.TextTool.toolName),children:"\u6587\u5B57"}),u("p",{onClick:l=>E(l,h.LineTool.toolName),children:"\u76F4\u7EBF"}),u("p",{onClick:l=>E(l,h.ArrowLineTool.toolName),children:"\u7BAD\u5934"}),u("p",{onClick:l=>E(l,h.FreehandTool.toolName),children:"freehand"}),u("p",{onClick:l=>S(),children:"\u88C1\u526A"}),u("p",{onClick:l=>{t||a(!1),o(!t)},children:t?"\u9690\u85CF\u6807\u6CE8":"\u663E\u793A\u6807\u6CE8"}),u("p",{onClick:l=>{i||o(!1),a(!i)},children:i?"\u9690\u85CF\u622A\u56FE":"\u663E\u793A\u622A\u56FE"}),u("p",{onClick:l=>s.onChangeDragging(),children:s.dragging?"\u53D6\u6D88\u62D6\u52A8":"\u62D6\u52A8"})]}),t&&x("div",{className:"common-pannel annotations-layer",children:[u("div",{className:"title outer sticky top-0 bg-white",children:"\u6807\u6CE8\u4FE1\u606F"}),e.map(l=>l.belong===h.CropTool.toolName?null:x("div",{className:"items-center outer",children:[u("span",{className:"text-15px font-500",children:l.belong}),x("div",{className:"flex flex-col space-y-5px !py-5px flex-1 !mx-15px w-0",children:[x("span",{children:["\u6807\u9898: ",l.info.title]}),x("span",{children:["\u5907\u6CE8: ",l.info.remark]}),x("span",{children:["\u5176\u4ED6\u4FE1\u606F: ",l.info.others]}),x("span",{children:["\u65F6\u95F4: ",R(l.info.time).format("DD HH:mm:ss")]})]}),x("div",{className:"flex flex-col space-y-10px children:h-25px",children:[u("button",{onClick:()=>N(l),children:"\u7F16\u8F91"}),u("button",{onClick:()=>X(l),children:"\u5220\u9664"})]})]},`annotation-${l.info.time}`))]}),i&&x("div",{className:"common-pannel images-layer",children:[u("div",{className:"title outer sticky top-0 bg-white",children:"\u622A\u56FE"}),c.map((l,T)=>x("div",{className:"flex flex-col space-y-5px outer",children:[x("span",{className:"font-500 text-15px",children:["\u6807\u9898: ",l.info.title]}),x("span",{children:["\u65F6\u95F4: ",R(l.info.time).format("YYYY-MM-DD HH:mm")]}),x("div",{className:"flex items-center !mx-0 !py-0",children:[u("img",{className:"flex-1 w-0 mr-10px",src:l.url}),u("button",{onClick:()=>I(l),children:"\u5220\u9664"})]})]},`image-${l.info.time}`))]})]})};function yt(){const s=P.exports.useRef(null),[t,o]=P.exports.useState(),[e,n]=P.exports.useState(),[i,a]=P.exports.useState(),[c,m]=P.exports.useState(1),[g,p]=P.exports.useState(!1),[f,E]=P.exports.useState({x:0,y:0}),[S,N]=P.exports.useState(),X=new h.TextTool,I=new h.CircleTool,l=new h.SquareTool,T=new h.LineTool,Y=new h.FreehandTool,w=new h.ArrowLineTool,B=new h.CropTool;B.startRect=d=>{N(void 0)},B.endRect=d=>{N([d.startX,d.startY])};const D=async d=>{const y=await et();return y||gt.last(d.annotations).remove(),M(v({},y),{time:new Date().getTime()})},[C]=P.exports.useState(()=>{const d=new h;return d.useTool(X,D).useTool(I,D).useTool(l,D).useTool(T,D).useTool(Y,D).useTool(w,D).useTool(B,D),d.usePlugin(new h.MovePlugin,[I,l,X]).usePlugin(new h.ScalePlugin,[l,I]),d});P.exports.useEffect(()=>{if(e){const d=e.createDiv();d.addClass("w-130px h-50px"),ht.exports.render(x(q,{children:[u("button",{className:"mr-10px w-50px h-30px",onClick:y=>{nt(y)},children:"\u786E\u8BA4"}),u("button",{className:"w-50px h-30px",onClick:ot,children:"\u53D6\u6D88"})]}),d.elt),a(d)}},[e]),P.exports.useEffect(()=>{!i||(S?(i.position(S[0],S[1]-35),i.show()):i.hide())},[S,i]);const V=P.exports.useCallback(()=>{!e||!t||(e.clear(),e.resizeCanvas(t.width*c,t.height*c,!1),e.image(t,f.x,f.y,t.width*c,t.height*c),C.draw(e,c,f.x,f.y))},[c,e,t,f]);P.exports.useEffect(()=>{e&&t&&(e.draw=V,e.touchStarted=d=>{d.target.nodeName==="CANVAS"&&(g||C.touchStarted(e))},e.touchMoved=d=>{g?E({x:f.x+e.mouseX-e.pmouseX,y:f.y+e.mouseY-e.pmouseY}):C.touchMoved(e)},e.touchEnded=()=>{var d;g||(C.touchEnded(e),((d=C.enabledTool)==null?void 0:d.name)!==h.CropTool.toolName&&C.quitTool())},e.setup=()=>{const d={x:0,y:0};e.createCanvas(d.x,d.y),C.setup(e)},e.mouseWheel=d=>{if(d.target.nodeName==="CANVAS"){const y=c-d.deltaY/100;m(Math.max(Math.min(y,5),.5))}})},[e,t,V,g]),P.exports.useEffect(()=>{s.current&&new dt(d=>{n(d),d.preload=()=>{d.loadImage("https://picsum.photos/1200/600",y=>{o(y)}),C.preload(d)}},s.current)},[]);const ot=d=>{N(void 0),(C==null?void 0:C.findTool(h.CropTool.toolName)).endCrop()},nt=d=>{N(void 0),(C==null?void 0:C.findTool(h.CropTool.toolName)).doCrop(e)};return x("div",{className:"relative flex items-center justify-center w-screen h-screen overflow-hidden",id:"test",children:[u("div",{ref:s,className:"absolute left-0 right-0 top-0 bottom-0"}),u(It,{manager:C,sk:e,onChangeDragging:()=>p(!g),dragging:g})]})}L.render(u(ft.StrictMode,{children:u(yt,{})}),document.getElementById("root"));
//# sourceMappingURL=index.7a60ca05.js.map

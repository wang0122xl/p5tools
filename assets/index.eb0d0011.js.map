{"version":3,"file":"index.eb0d0011.js","sources":["../../vite/modulepreload-polyfill","../../libs/utils/index.ts","../../libs/utils/emitter.ts","../../libs/tools/baseTool/index.ts","../../libs/tools/circleTool.ts","../../libs/tools/squareTool.ts","../../libs/tools/lineTool.ts","../../libs/tools/arrowLineTool.ts","../../libs/tools/freehandTool.ts","../../libs/tools/textTool.ts","../../libs/tools/cropTool.ts","../../libs/tools/magnify.ts","../../libs/plugins/index.ts","../../libs/plugins/move.ts","../../libs/plugins/scale.ts","../../libs/tools/angle.ts","../../libs/manager/index.ts","../../example/components/choose-options.tsx","../../example/components/edit-info.tsx","../../example/components/pannel.tsx","../../example/App.tsx","../../example/main.tsx"],"sourcesContent":["const p = function polyfill() {\n    const relList = document.createElement('link').relList;\n    if (relList && relList.supports && relList.supports('modulepreload')) {\n        return;\n    }\n    for (const link of document.querySelectorAll('link[rel=\"modulepreload\"]')) {\n        processPreload(link);\n    }\n    new MutationObserver((mutations) => {\n        for (const mutation of mutations) {\n            if (mutation.type !== 'childList') {\n                continue;\n            }\n            for (const node of mutation.addedNodes) {\n                if (node.tagName === 'LINK' && node.rel === 'modulepreload')\n                    processPreload(node);\n            }\n        }\n    }).observe(document, { childList: true, subtree: true });\n    function getFetchOpts(script) {\n        const fetchOpts = {};\n        if (script.integrity)\n            fetchOpts.integrity = script.integrity;\n        if (script.referrerpolicy)\n            fetchOpts.referrerPolicy = script.referrerpolicy;\n        if (script.crossorigin === 'use-credentials')\n            fetchOpts.credentials = 'include';\n        else if (script.crossorigin === 'anonymous')\n            fetchOpts.credentials = 'omit';\n        else\n            fetchOpts.credentials = 'same-origin';\n        return fetchOpts;\n    }\n    function processPreload(link) {\n        if (link.ep)\n            // ep marker = processed\n            return;\n        link.ep = true;\n        // prepopulate the load record\n        const fetchOpts = getFetchOpts(link);\n        fetch(link.href, fetchOpts);\n    }\n};__VITE_IS_MODERN__&&p();","/*\n * @Date: 2022-02-25 17:53:30\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-03-10 21:45:32\n * @Description: file content\n */\n\nexport type CursorPoint = [x: number, y: number]\n\nfunction distanceBetween(start: CursorPoint, end: CursorPoint) {\n    const sum = Math.pow(end[0] - start[0], 2) + Math.pow(end[1] - start[1], 2)\n\n    return Math.pow(\n        sum,\n        1 / 2\n    )\n}\n\nfunction degreeBetween(start: CursorPoint, end: CursorPoint, mode?: 'RADIANS' | 'DEGREES') {\n    const radian = Math.atan2(start[1] - end[1], start[0] - end[0])\n    if (mode !== 'DEGREES') {\n        return radian\n    }\n    const angle = 180 / Math.PI * radian\n    return angle\n}\n\nfunction promisifyToBlob(canvas: HTMLCanvasElement, type?: string, quality?: number): Promise<Blob | null> {\n    return new Promise(resolve => {\n        canvas.toBlob(blob => {\n            resolve(blob)\n        }, type, quality)\n    })\n}\n\nexport {\n    distanceBetween,\n    degreeBetween,\n    promisifyToBlob\n}","/*\n * @Date: 2022-02-25 15:31:22\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-03-03 20:52:03\n * @Description: file content\n */\n\nimport { EventEmitter } from \"events\";\n\n/** plugin 活跃时触发，触发时将其余plugin设为非活跃状态 */\nexport const EMITTER_PLUGIN_ACTIVED = 'EMITTER_PLUGIN_ACTIVED'\n/** 标注信息更改时触发 */\nexport const EMITTER_ANNOTATION_INFO_UPDATED = 'EMITTER_ANNOTATION_INFO_UPDATED'\n/** crop 截取完成时触发 */\nexport const EMITTER_ANNOTATION_CROPPED = 'EMITTER_ANNOTATION_INFO_UPDATED'\n\nexport default new EventEmitter()\n","/*\n * @Date: 2022-02-24 15:58:06\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-11-01 20:24:47\n * @Description: 基础工具\n */\n\nimport P5, { THE_STYLE } from 'p5'\nimport { distanceBetween } from '../../utils/index'\nimport type { CursorPoint } from '../../utils/index'\nimport emitter, { EMITTER_ANNOTATION_INFO_UPDATED } from \"../../utils/emitter\"\n\nexport interface P5ToolOptions {\n    strokeWeight?: number\n    strokeColor?: string\n    strokeAlpha?: number\n    fillColor?: string\n    textSize?: number\n    textStyle?: THE_STYLE\n}\n\nexport interface P5ToolBaseInfo<Other = any> {\n    title?: string // 标题\n    time?: number // 更新时间的时间戳\n    remark?: string // 备注\n    others?: Other\n}\nexport interface P5ToolAnnotation<Name = string, OtherType = any> {\n    info: P5ToolBaseInfo<OtherType>\n    belong: Name // 所属工具\n    startPoint?: CursorPoint\n    endPoint?: CursorPoint\n    options: P5ToolOptions // p5 绘图所需的选项\n    translateX: number\n    translateY: number\n    scale: number\n    transformedStartPoint: () => CursorPoint | undefined\n    transformedEndPoint: () => CursorPoint | undefined\n    remove: () => void\n}\n\nexport type P5ToolGetInfo = (tool: P5BaseTool<any>) => Promise<P5ToolBaseInfo>\n\nclass P5BaseTool<\n    AnnotationType extends P5ToolAnnotation,\n    ToolState extends Record<string, any> = any\n> {\n    static readonly toolName: string\n\n    public annotations: AnnotationType[] = []\n    public name: AnnotationType['belong']\n    public editingAnnotation?: AnnotationType\n    public options?: P5ToolOptions\n    public pluginsCount: number = 0\n\n    public pluginItemWH: number = 20\n    public pluginItemMargin: number = 5\n\n    public state: ToolState\n\n    public scale: number = 1\n    public translateX: number = 0\n    public translateY: number = 0\n\n    /** 加载的图片 */\n    public loadedImage?: P5.Image\n\n    public customConfigAnnotation?: (tool: P5BaseTool<any>, anno: AnnotationType) => void\n\n    /**\n     * @description: 获取文字的回调函数\n     * @param {*} Promise\n     * @return {*}\n     */    \n     public getToolInfo: P5ToolGetInfo = () => {\n         return Promise.resolve({\n             time: new Date().getTime()\n         })\n     }\n\n    constructor (\n        name: AnnotationType['belong'],\n        annotations?: AnnotationType[],\n        initialState?: ToolState\n    ) {\n        this.name = name\n        annotations && (this.annotations = annotations)\n        this.state = (initialState || {}) as ToolState\n    }\n\n    public transformValue = (v: number) => {\n        return v * this.scale\n    }\n\n    /**\n     * @description: 获取原始坐标转换后的新坐标位置，scale, translate, etc..\n     * @param {CursorPoint} point\n     * @return {*}\n     */    \n    public transformPoint = (point: CursorPoint) => {\n        return [\n            this.transformValue(point[0]) + this.translateX,\n            this.transformValue(point[1]) + this.translateY\n        ] as CursorPoint\n    }\n\n    /**\n     * @description: 获取画布坐标再未转换前的原始位置\n     * @param {CursorPoint} point\n     * @return {*}\n     */    \n    public restorePoint = (point: CursorPoint) => {\n        return [\n            (point[0] - this.translateX) / this.scale,\n            (point[1] - this.translateY) / this.scale\n        ] as CursorPoint\n    }\n\n    /**\n     * @description: 根据标注的option设置sk\n     * @param {AnnotationType} anno\n     * @return {*}\n     */    \n    public configAnnotation(sk: P5, anno: AnnotationType): void {\n        const options = anno.options\n        if (options?.strokeColor) {\n            const color = sk.color(options.strokeColor)\n            const alpha = sk.map(options.strokeAlpha || 1, 0, 1, 0, 255)\n\n            color.setAlpha(alpha)\n            sk.stroke(color)\n        } else {\n            sk.noStroke()\n        }\n        if (options?.fillColor) {\n            sk.fill(options.fillColor)\n        } else {\n            sk.noFill()\n        }\n        options?.textSize && sk.textSize(options.textSize * this.scale)\n        options?.strokeWeight && sk.strokeWeight(options.strokeWeight * this.scale)\n        options?.textStyle && sk.textStyle(options.textStyle)\n\n        this.customConfigAnnotation?.(this, anno)\n    }\n\n    /**\n     * @description: 获取初始化的标注设置信息\n     * @param {*}\n     * @return {*}\n     */    \n    public getInitialOptions(): P5ToolOptions {\n        return {\n            textSize: 12,\n            strokeColor: '#111',\n            strokeWeight: 1,\n        }\n    }\n    /**\n     * @description: 获取初始化的标注信息\n     * @param \n     * @return BaseAnnotation\n     */    \n    public getInitialAnnotation(): P5ToolAnnotation {\n        const self = this\n        return {\n            info: {\n                time: new Date().getTime(),\n            },\n            remove: function() {\n                self.annotations.splice(self.annotations.indexOf(this as any), 1)\n            },\n            belong: this.name,\n            options: {...this.getInitialOptions(), ...this.options},\n            translateX: 0,\n            translateY: 0,\n            scale: 1,\n            transformedStartPoint: function () {\n                if (!this.startPoint) {\n                    return undefined\n                }\n                return [\n                    self.transformValue(this.startPoint[0] + this.translateX) + self.translateX,\n                    self.transformValue(this.startPoint[1] + this.translateY) + self.translateY\n                ] as CursorPoint\n            },\n            transformedEndPoint: function () {\n                if (!this.endPoint) {\n                    return undefined\n                }\n                return [\n                    self.transformValue(this.endPoint[0] + this.translateX) + self.translateX,\n                    self.transformValue(this.endPoint[1] + this.translateY) + self.translateY\n                ] as CursorPoint\n            }\n        }\n    }\n\n    /**\n     * @description: 验证annotation是否合法（防抖）\n     * @param {AnnotationType} annotation\n     * @return {*}\n     */    \n    public validateAnnotation(annotation: AnnotationType) {\n        if (distanceBetween(annotation.startPoint!, annotation.endPoint!) < 2) {\n            return false\n        }\n        return true\n    }\n\n    /**\n     * @description: p5 preload\n     * @param {P5} sk\n     * @return {*}\n     */    \n    public preload(sk: P5) {\n\n    }\n\n    /**\n     * @description: p5 setup\n     * @param {P5} sk\n     * @return {*}\n     */    \n    public setup(sk: P5) {\n\n    }\n\n    /**\n     * @description: p5 mouseMoved\n     * @param {P5} sk\n     * @return {*}\n     */    \n     public mouseMoved(sk: P5) {\n         \n    }\n\n    /**\n     * @description: p5 draw\n     * @param {P5} sk\n     * @return {*}\n     */    \n    public draw(sk: P5) {\n        \n    }\n\n    /**\n     * @description: p5 touchStarted\n     * @param {P5} sk\n     * @param {any} event\n     * @return {*}\n     */    \n    public touchStarted(sk: P5) {\n        this.editingAnnotation = {\n            ...this.getInitialAnnotation(),\n            startPoint: this.restorePoint([sk.mouseX, sk.mouseY])\n        } as AnnotationType\n        this.annotations.push(this.editingAnnotation)\n    }\n\n    /**\n     * @description: p5 touchMoved\n     * @param {P5} sk\n     * @return {*}\n     */    \n    public touchMoved(sk: P5) {\n        if (!this.editingAnnotation) {\n            this.touchStarted(sk)\n        } else {\n            this.editingAnnotation!.endPoint = this.restorePoint([sk.mouseX, sk.mouseY])\n        }\n    }\n\n    /**\n     * @description: p5 touchEnded\n     * @param {P5} sk\n     * @return {*}\n     */    \n    public touchEnded(sk: P5) {\n        if (!this.editingAnnotation) {\n            return\n        }\n        this.editingAnnotation!.endPoint = this.restorePoint([sk.mouseX, sk.mouseY])\n        // 当前编辑的annotation非法，删除此annotation\n        if (!this.validateAnnotation(this.editingAnnotation!)) {\n            this.annotations?.pop()\n            this.editingAnnotation = undefined\n        } else {\n            this.getToolInfo(this).then(info => {\n                if (this.editingAnnotation) {\n                    this.editingAnnotation.info = info\n                    emitter.emit(EMITTER_ANNOTATION_INFO_UPDATED)\n                }\n            }).catch(e => {\n                console.warn(e)\n            }).finally(() => {\n                this.editingAnnotation = undefined\n            })\n        }\n    }\n\n    /**\n     * @description: 反转起始和终止点，使起始点永远在左上角\n     * @param {*}\n     * @return {*}\n     */    \n    public reverseStartEndPointByOrder() {\n        if (this.editingAnnotation && this.editingAnnotation.startPoint && this.editingAnnotation.endPoint) {\n            const [startX, startY] = this.editingAnnotation.startPoint\n            const [endX, endY] = this.editingAnnotation.endPoint\n            this.editingAnnotation.startPoint = [Math.min(startX, endX), Math.min(startY, endY)]\n            this.editingAnnotation.endPoint = [Math.max(startX, endX), Math.max(startY, endY)]\n        }\n    }\n\n    /**\n     * @description: 判断点坐标是否在annotation范围内\n     * @param {CursorPoint} point\n     * @param {P5ToolAnnotation} annotation\n     * @return {*}\n     */    \n    public pointInAnnotation(point: CursorPoint, annotation: P5ToolAnnotation): boolean {\n        return false\n    }\n\n    /**\n     * @description: 获取annotation对应的插件视图起始位置\n     * @param {P5ToolAnnotation} annotation\n     * @return {*}\n     */    \n    public getPluginOrigin(annotation: P5ToolAnnotation): CursorPoint {\n        return annotation.startPoint || [0, 0]\n    }\n\n    public pointInPluginLayer(point: CursorPoint, annotation: P5ToolAnnotation<any>) {\n        const origin = this.getPluginOrigin(annotation)\n        if (\n            point[0] > origin[0] &&\n            point[0] < origin[0] + (this.pluginItemWH + this.pluginItemMargin) * this.pluginsCount &&\n            point[1] > origin[1] &&\n            point[1] < origin[1] + this.pluginItemWH\n        ) {\n            return true\n        }\n        return false\n    }\n}\n\nexport default P5BaseTool","/*\n * @Date: 2022-02-24 15:58:06\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-03-05 13:52:27\n * @Description: file content\n */\n\nimport P5BaseTool, { P5ToolAnnotation } from './baseTool/index'\nimport P5 from 'p5'\nimport { CursorPoint, distanceBetween } from '../utils/index'\n\ninterface CircleToolAnnotation extends P5ToolAnnotation<'CircleTool'> {\n\n}\n\nclass CircleTool extends P5BaseTool<CircleToolAnnotation> {\n    static toolName = 'CircleTool'\n\n    constructor(annotations?: CircleToolAnnotation[]) {\n        super('CircleTool', annotations)\n    }\n\n    public getPluginOrigin(annotation: P5ToolAnnotation<string>): CursorPoint {\n        const startPoint = annotation.transformedStartPoint()\n        const endPoint = annotation.transformedEndPoint()\n        if (startPoint && endPoint) {\n            const distance = distanceBetween(startPoint, endPoint)\n            return [\n                startPoint[0] + distance + (annotation.options.strokeWeight || 1) * this.scale / 2,\n                startPoint[1] - this.pluginItemWH / 2\n            ]\n        }\n\n        return [0, 0]\n    }\n\n    public pointInAnnotation(point: CursorPoint, annotation: CircleToolAnnotation): boolean {\n        const startPoint = annotation.transformedStartPoint()\n        const endPoint = annotation.transformedEndPoint()\n        if (!startPoint || !endPoint) {\n            return false\n        }\n\n        const originDistance = distanceBetween(startPoint, endPoint)\n        const distance = distanceBetween(startPoint as CursorPoint, point)\n        if (distance < originDistance) {\n            return true\n        }\n        return this.pointInPluginLayer(point, annotation)\n    }\n\n    public touchEnded(sk: P5): void {\n        super.touchEnded(sk)\n        if (this.editingAnnotation) {\n            const [startX, startY] = this.editingAnnotation.startPoint!\n            const distance = distanceBetween(this.editingAnnotation.startPoint!, this.editingAnnotation.endPoint!)\n            this.editingAnnotation.endPoint = [\n                startX + distance,\n                startY\n            ]\n        }\n    }\n\n    public draw(sk: P5): void {\n        for (const annotation of this.annotations || []) {\n            const startPoint = annotation.transformedStartPoint()\n            const endPoint = annotation.transformedEndPoint()\n\n            if (!startPoint || !endPoint) {\n                return\n            }\n\n            super.configAnnotation(sk, annotation)\n\n            sk.circle(\n                startPoint[0],\n                startPoint[1],\n                distanceBetween(startPoint, endPoint) * 2\n            )\n        }\n    }\n}\n\nexport default CircleTool","/*\n * @Date: 2022-02-24 15:58:06\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-08-10 23:32:26\n * @Description: file content\n */\n\nimport P5BaseTool, { P5ToolAnnotation } from './baseTool'\nimport P5 from 'p5'\nimport { CursorPoint } from '../utils'\n\ninterface SquareToolAnnotation extends P5ToolAnnotation<'SquareTool'> {\n\n}\n\nclass SquareTool extends P5BaseTool<SquareToolAnnotation> {\n    static toolName = 'SquareTool'\n    \n    constructor (annotations?: SquareToolAnnotation[]) {\n        super('SquareTool', annotations)\n    }\n\n    public getPluginOrigin(annotation: P5ToolAnnotation<string>): CursorPoint {\n        const startPoint = annotation.transformedStartPoint()\n        const endPoint = annotation.transformedEndPoint()\n        if (!endPoint || !startPoint) {\n            return [0, 0]\n        }\n        \n        const xParams = [startPoint[0], endPoint[0]]\n        const yParams = [startPoint[1], endPoint[1]]\n\n        return [\n            Math.max(...xParams) + (annotation.options.strokeWeight || 1) * this.scale,\n            Math.max(...yParams) - this.pluginItemWH + (annotation.options.strokeWeight || 1) * this.scale / 2\n        ]\n    }\n\n    public touchEnded(sk: P5): void {\n        super.touchEnded(sk)\n        this.reverseStartEndPointByOrder()\n    }\n\n    public pointInAnnotation(point: CursorPoint, annotation: P5ToolAnnotation<string>): boolean {\n        const startPoint = annotation.transformedStartPoint()\n        const endPoint = annotation.transformedEndPoint()\n        if (!endPoint || !startPoint) {\n            return false\n        }\n\n        const xParams = [startPoint[0], endPoint[0]]\n        const yParams = [startPoint[1], endPoint[1]]\n\n        if (\n            point[0] < Math.max(...xParams) &&\n            point[0] > Math.min(...xParams) &&\n            point[1] < Math.max(...yParams) &&\n            point[1] > Math.min(...yParams)\n        ) {\n            return true\n        }\n\n        return this.pointInPluginLayer(point, annotation)\n    }\n\n    public draw(sk: P5): void {\n        for (const annotation of this.annotations || []) {\n            const startPoint = annotation.transformedStartPoint()\n            const endPoint = annotation.transformedEndPoint()\n            if (!startPoint || !endPoint) {\n                return\n            }\n\n            super.configAnnotation(sk, annotation)\n            \n            sk.quad(\n                startPoint[0],\n                startPoint[1],\n                endPoint[0],\n                startPoint[1],\n                endPoint[0],\n                endPoint[1],\n                startPoint[0],\n                endPoint[1]\n            )\n\n        }\n    }\n}\n\nexport default SquareTool","/*\n * @Date: 2022-02-24 15:58:06\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-11-01 18:24:57\n * @Description: file content\n */\n\nimport P5BaseTool, { P5ToolAnnotation } from './baseTool'\nimport P5 from 'p5'\nimport { distanceBetween } from '../utils'\n\ninterface LineToolAnnotation extends P5ToolAnnotation<'LineTool'> {\n    \n}\n\nclass LineTool extends P5BaseTool<LineToolAnnotation> {\n    static toolName = 'LineTool'\n    public showDistance = false\n    \n    constructor (annotations?: LineToolAnnotation[]) {\n        super('LineTool', annotations)\n    }\n\n    public draw(sk: P5): void {\n        for (const annotation of this.annotations || []) {\n            const startPoint = annotation.transformedStartPoint()\n            const endPoint = annotation.transformedEndPoint()\n\n            if (!startPoint || !endPoint) {\n                return\n            }\n            \n            super.configAnnotation(sk, annotation)\n\n            sk.line(\n                startPoint[0],\n                startPoint[1],\n                endPoint[0],\n                endPoint[1]\n            )\n            sk.textSize(annotation.options.textSize! * this.scale)\n            sk.fill(annotation.options.strokeColor!)\n            \n            if (this.showDistance) {\n                sk.text(\n                    distanceBetween(startPoint, endPoint).toFixed(1),\n                    (endPoint[0] - startPoint[0]) / 2 + (this.options?.strokeWeight || 5) + startPoint[0],\n                    (endPoint[1] - startPoint[1]) / 2 + (this.options?.strokeWeight || 5) + startPoint[1] + annotation.options.textSize!,\n                )\n            }\n        }\n    }\n}\n\nexport default LineTool","/*\n * @Date: 2022-02-24 15:58:06\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-03-10 22:41:20\n * @Description: file content\n */\n\nimport P5BaseTool, { P5ToolAnnotation } from './baseTool'\nimport P5 from 'p5'\nimport { degreeBetween } from '../utils/index'\n\ninterface ArrowLineToolAnnotation extends P5ToolAnnotation<'ArrowLineTool'> {\n\n}\n\nclass ArrowLineTool extends P5BaseTool<ArrowLineToolAnnotation> {\n    static toolName = 'ArrowLineTool'\n    \n    constructor (annotations?: ArrowLineToolAnnotation[]) {\n        super('ArrowLineTool', annotations)\n        this.getToolInfo = () => {\n            const title = prompt('请输入') || ''\n            return Promise.resolve({\n                title,\n                time: new Date().getTime()\n            })\n        }\n    }\n\n    public draw(sk: P5): void {\n        for (const annotation of this.annotations || []) {\n            const startPoint = annotation.transformedStartPoint()\n            const endPoint = annotation.transformedEndPoint()\n\n            if (!startPoint || !endPoint) {\n                return\n            }\n            sk.angleMode('degrees')\n            const radio = degreeBetween(startPoint, endPoint, 'DEGREES')\n            const ratio = (annotation.options?.strokeWeight || 1) * 8\n            const arrowPoint1 = [\n                startPoint[0] + ratio * sk.cos(radio - 145) * this.scale,\n                startPoint[1] + ratio * sk.sin(radio - 145) * this.scale\n            ]\n            const arrowPoint2 = [\n                startPoint[0] + ratio * sk.cos(radio + 145) * this.scale,\n                startPoint[1] + ratio * sk.sin(radio + 145) * this.scale\n            ] \n            \n            super.configAnnotation(sk, annotation)\n\n            sk.line(\n                startPoint[0],\n                startPoint[1],\n                endPoint[0],\n                endPoint[1]\n            )\n            sk.line(\n                startPoint[0],\n                startPoint[1],\n                arrowPoint1[0],\n                arrowPoint1[1]\n            )\n            sk.line(\n                startPoint[0],\n                startPoint[1],\n                arrowPoint2[0],\n                arrowPoint2[1]\n            )\n            sk.noStroke()\n            sk.textSize(annotation.options.textSize! * this.scale)\n            sk.fill(annotation.options.strokeColor!)\n            sk.text(\n                annotation.info.title || '',\n                startPoint[0] + 5 * sk.cos(radio) / 4,\n                startPoint[1] + 5 * sk.sin(radio) / 4 + 0.8 * (radio > 0 ? sk.textAscent() : -sk.textAscent() * 0.5)\n            )\n\n            \n        }\n    }\n}\n\nexport default ArrowLineTool","/*\n * @Date: 2022-02-24 15:58:06\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-03-07 14:20:37\n * @Description: file content\n */\n\nimport P5BaseTool, { P5ToolAnnotation } from './baseTool'\nimport P5 from 'p5'\nimport { distanceBetween } from '../utils/index'\nimport type { CursorPoint } from '../utils/index'\n\ninterface FreehandToolAnnotation extends P5ToolAnnotation<'FreehandTool'> {\n    freePaths: CursorPoint[]\n}\n\nclass FreehandTool extends P5BaseTool<FreehandToolAnnotation> {\n    static toolName = 'FreehandTool'\n    \n    constructor (annotations?: FreehandToolAnnotation[]) {\n        super('FreehandTool', annotations)\n    }\n\n    public getInitialAnnotation(): FreehandToolAnnotation {\n        return {\n            ...super.getInitialAnnotation(),\n            belong: 'FreehandTool',\n            freePaths: []\n        }\n    }\n\n    public touchMoved(sk: P5): void {\n        const prevPoint = this.editingAnnotation?.freePaths[this.editingAnnotation.freePaths.length - 1] || this.editingAnnotation?.startPoint\n        const point = this.restorePoint([sk.mouseX, sk.mouseY])\n\n        if (prevPoint && point && distanceBetween(prevPoint, point) > 4) {\n            this.editingAnnotation?.freePaths.push(point)\n        }\n    }\n\n    public draw(sk: P5): void {\n        for (const annotation of this.annotations || []) {\n            const startPoint = annotation.startPoint\n            const endPoint = annotation.endPoint\n            const allPaths = [startPoint, ...annotation.freePaths, endPoint]\n            \n            super.configAnnotation(sk, annotation)\n            \n            for (let i = 0; i < allPaths.length - 1; i++) {\n                const start = allPaths[i]\n                const end = allPaths[i + 1]\n\n                if (!end) {\n                    break\n                }\n\n                const transformedStart = this.transformPoint(start!)\n                const transformedEnd = this.transformPoint(end!)\n                \n                sk.line(\n                    transformedStart[0],\n                    transformedStart[1],\n                    transformedEnd[0],\n                    transformedEnd[1]\n                )\n            }\n        }\n    }\n}\n\nexport default FreehandTool","/*\n * @Date: 2022-02-24 15:58:06\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-03-10 22:40:00\n * @Description: file content\n */\n\nimport P5BaseTool, { P5ToolAnnotation } from './baseTool'\nimport P5 from 'p5'\nimport { CursorPoint } from '../utils'\n\ninterface TextToolAnnotation extends P5ToolAnnotation<'TextTool'> {\n    textWidth: number\n    textHeight: number\n}\n\nclass TextTool extends P5BaseTool<TextToolAnnotation> {\n    static toolName = 'TextTool'\n\n    constructor(annotations?: TextToolAnnotation[]) {\n        super('TextTool', annotations)\n        this.getToolInfo = () => {\n            const title = prompt('请输入') || ''\n            return Promise.resolve({\n                title,\n                time: new Date().getTime()\n            })\n        }\n    }\n\n    public validateAnnotation(annotation: TextToolAnnotation): boolean {\n        return true\n    }\n\n    public touchEnded(sk: P5): void {\n        super.touchEnded(sk)\n        if (this.editingAnnotation) {\n            this.editingAnnotation.startPoint = this.restorePoint([sk.mouseX, sk.mouseY])\n        }\n    }\n\n\n    public getPluginOrigin(annotation: TextToolAnnotation): CursorPoint {\n        const startPoint = annotation.transformedStartPoint()\n\n        if (!startPoint) {\n            return [0, 0]\n        }\n\n        return [\n            startPoint[0] - annotation.textWidth / 2,\n            startPoint[1] - this.pluginItemWH - annotation.textHeight\n        ]\n    }\n\n    public pointInAnnotation(point: CursorPoint, annotation: TextToolAnnotation): boolean {\n        const startPoint = annotation.transformedStartPoint()\n        if (!startPoint) {\n            return false\n        }\n\n\n        const halfTextWidth = annotation.textWidth / 2\n\n        if (\n            point[0] > startPoint[0] - halfTextWidth &&\n            point[0] < startPoint[0] + halfTextWidth &&\n            point[1] > startPoint[1] - annotation.textHeight &&\n            point[1] < startPoint[1]\n        ) {\n            return true\n        }\n\n        return this.pointInPluginLayer(point, annotation)\n    }\n\n    public draw(sk: P5): void {\n        for (const annotation of this.annotations || []) {\n            const startPoint = annotation.transformedStartPoint()\n\n            if (!startPoint) {\n                return\n            }\n\n\n            super.configAnnotation(sk, annotation)\n            sk.noStroke()\n\n            const text = annotation.info.title || ''\n            const textWidth = sk.textWidth(text)\n            annotation.textWidth = textWidth\n            const textHeight = sk.textAscent()\n            annotation.textHeight = textHeight\n\n            sk.text(\n                text,\n                startPoint[0] - textWidth / 2,\n                startPoint[1]\n            )\n        }\n    }\n}\n\nexport default TextTool","/*\n * @Date: 2022-02-24 15:58:06\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-11-01 20:27:35\n * @Description: file content\n */\n\nimport P5BaseTool, { P5ToolAnnotation, P5ToolBaseInfo, P5ToolGetInfo } from './baseTool'\nimport P5 from 'p5'\nimport { CursorPoint, promisifyToBlob } from '../utils'\nimport emitter, { EMITTER_ANNOTATION_CROPPED } from '../utils/emitter'\n\ntype CursorPosition = 'top' | 'top-right' | 'top-left' | 'left' | 'right' | 'bottom' | 'bottom-left' | 'bottom-right' | 'in-rect' | 'out-rect'\n\nconst CursorStyleMapping: Record<CursorPosition, string> = {\n    'top': 'ns-resize',\n    'top-right': 'nesw-resize',\n    'top-left': 'nwse-resize',\n    'left': 'ew-resize',\n    'right': 'ew-resize',\n    'in-rect': 'MOVE',\n    'out-rect': 'default',\n    'bottom': 'ns-resize',\n    'bottom-left': 'nesw-resize',\n    'bottom-right': 'nwse-resize'\n}\n\nconst offset = 6 // 误差\n\ninterface CropToolAnnotation extends P5ToolAnnotation<'CropTool'> {\n    \n}\n\nconst getPointPosition = (point: CursorPoint, start?: CursorPoint, end?: CursorPoint): CursorPosition => {\n    let position: CursorPosition = 'out-rect'\n    if (!start || !end) {\n        return 'out-rect'\n    }\n\n    const [pointX, pointY] = point\n    const startX = Math.min(start[0], end[0])\n    const endX = Math.max(start[0], end[0])\n    const startY = Math.min(start[1], end[1])\n    const endY = Math.max(start[1], end[1])\n\n    const inLeftLine = pointX > startX - offset && pointX < startX + offset\n    const inTopLine = pointY > startY - offset && pointY < startY + offset\n    const inRightLine = pointX > endX - offset && pointX < endX + offset\n    const inBottomLine = pointY > endY - offset && pointY < endY + offset\n\n    if (pointX > startX + offset && pointX < endX - offset && pointY > startY + offset && pointY < endY - offset) {\n        position = 'in-rect'\n    } else if (inTopLine) {\n        position = 'top'\n        if (inLeftLine) {\n            position = 'top-left'\n        } else if (inRightLine) {\n            position = 'top-right'\n        }\n    } else if (inBottomLine) {\n        position = 'bottom'\n        if (inLeftLine) {\n            position = 'bottom-left'\n        } else if (inRightLine) {\n            position = 'bottom-right'\n        }\n    } else if (inLeftLine) {\n        position = 'left'\n    } else if (inRightLine) {\n        position = 'right'\n    } else {\n        position = 'out-rect'\n    }\n\n    return position\n\n}\n\ntype CropRectFunc = (p: {\n    startX: number\n    startY: number\n    endX?: number\n    endY?: number\n}) => void\n\nclass CropTool extends P5BaseTool<CropToolAnnotation, {\n    cropedImages: string[]\n}> {\n    static toolName = 'CropTool'\n    private cursorPosition: CursorPosition = 'out-rect'\n\n    private touchStartPoint: CursorPoint = [0, 0]\n\n    public images: {\n        info: P5ToolBaseInfo,\n        url: string\n    }[] = []\n\n    private pg?: P5\n\n    public startRect?: CropRectFunc\n    public endRect?: CropRectFunc\n\n    public endCrop () {\n        delete this.editingAnnotation?.startPoint\n        this.annotations = []\n    }\n\n    public async pureCrop(sk: P5, startPoint: CursorPoint, endPoint: CursorPoint, type?: string) {\n        const [startX, startY] = startPoint\n        const [endX, endY] = endPoint\n        const prevImage = sk.get()\n        sk.noLoop();\n        (sk as any).clear()\n        sk.image(prevImage, 0, 0, sk.width, sk.height)\n        const cropCanvas = ((sk.get(startX + offset / 2, startY + offset / 2, endX - startX - offset, endY - startY - offset) as any).canvas) as HTMLCanvasElement\n\n        const cropBlob = await promisifyToBlob(cropCanvas, type)\n        sk.loop()\n        return cropBlob\n    }\n\n    public async doCrop (sk: P5, beforeCallback?: (sk: P5) => Promise<unknown>, endCallback?: (sk: P5) => Promise<unknown>) {\n        const anno = this.annotations[0]\n\n        await beforeCallback?.(sk)\n        const cropBlob = await this.pureCrop(sk, anno.transformedStartPoint()!, anno.transformedEndPoint()!)\n        await endCallback?.(sk)\n\n        if (cropBlob) {\n            const url = URL.createObjectURL(cropBlob)\n            const info = await this.getToolInfo(this);\n            this?.images.push({\n                info,\n                url\n            })\n            emitter.emit(EMITTER_ANNOTATION_CROPPED)\n        }\n\n        this.endCrop()\n    }\n\n    constructor(annotations?: CropToolAnnotation[], images?: string[]) {\n        super('CropTool', annotations)\n        this.state.cropedImages = images || []\n    }\n\n    public touchStarted(sk: P5): void {\n        const startPoint = this.editingAnnotation?.startPoint\n        const endPoint = this.editingAnnotation?.endPoint\n        const restoredPoint = this.restorePoint([sk.mouseX, sk.mouseY])\n        this.cursorPosition = getPointPosition(restoredPoint, startPoint, endPoint)\n\n        if (this.cursorPosition === 'out-rect') {\n            this.editingAnnotation = {\n                ...this.getInitialAnnotation(),\n                belong: 'CropTool',\n                startPoint: restoredPoint,\n            }\n            this.annotations = [this.editingAnnotation]\n            this.startRect?.({\n                startX: restoredPoint[0],\n                startY: restoredPoint[1]\n            })\n        }\n\n        this.touchStartPoint = [sk.mouseX, sk.mouseY]\n    }\n\n    public touchMoved(sk: P5): void {\n        const anno = this.editingAnnotation!\n        const restoredPoint = this.restorePoint([sk.mouseX, sk.mouseY])\n\n        if (this.cursorPosition === 'out-rect') {\n            anno.endPoint = restoredPoint\n        }\n\n        const startPoint = anno.startPoint\n        const endPoint = anno.endPoint\n\n        let startX: number = startPoint![0]\n        let startY: number = startPoint![1]\n        let endX: number = endPoint![0]\n        let endY: number = endPoint![1]\n        const transformX = (sk.mouseX - this.touchStartPoint[0]) / this.scale\n        const transformY = (sk.mouseY - this.touchStartPoint[1]) / this.scale\n\n        switch (this.cursorPosition) {\n            case 'in-rect':\n                startX += transformX\n                startY += transformY\n                endX += transformX\n                endY += transformY\n                break;\n            case 'top':\n                startY += transformY\n                break\n            case 'bottom':\n                endY += transformY\n                break\n            case 'left':\n                startX += transformX\n                break\n            case 'right':\n                endX += transformX\n                break\n            case 'top-left':\n                startX += transformX\n                startY += transformY\n                break\n            case 'top-right':\n                endX += transformX\n                startY += transformY\n                break\n            case 'bottom-left':\n                startX += transformX\n                endY += transformY\n                break\n            case 'bottom-right':\n                endX += transformX\n                endY += transformY\n                break\n            default:\n                break;\n        }\n\n\n        anno.startPoint = [startX, startY]\n        anno.endPoint = [endX, endY]\n\n        this.touchStartPoint = [sk.mouseX, sk.mouseY]\n        \n        this.doEndRect()\n    }\n\n    private doEndRect () {\n        if (!this.editingAnnotation?.startPoint || !this.editingAnnotation.endPoint) {\n            return\n        }\n        const startPoint = this.editingAnnotation.transformedStartPoint()\n        const endPoint = this.editingAnnotation.transformedEndPoint()\n        this.endRect?.({\n            startX: Math.min(startPoint![0], endPoint![0]),\n            startY: Math.min(startPoint![1], endPoint![1]),\n            endX: Math.max(startPoint![0], endPoint![0]),\n            endY: Math.max(startPoint![1], endPoint![1])\n        })\n    }\n\n    public touchEnded(sk: P5): void {\n        if (this.editingAnnotation) {\n            this.reverseStartEndPointByOrder()\n        }\n    }\n\n    private drawCropArea(startX: number, startY: number, endX: number, endY: number) {\n        if (!this.pg) {\n            return\n        }\n        const annotation = this.editingAnnotation!\n\n        this.pg.erase()\n        this.pg.quad(\n            startX + annotation.translateX + 1,\n            startY + annotation.translateY + 1,\n            endX + annotation.translateX - 1,\n            startY + annotation.translateY + 1,\n            endX + annotation.translateX - 1,\n            endY + annotation.translateY - 1,\n            startX + annotation.translateX + 1,\n            endY + annotation.translateY - 1\n        )\n        this.pg.noErase()\n    }\n\n    public draw(sk: P5): void {\n        if (!this.pg) {\n            this.pg = sk.createGraphics(sk.width, sk.height)\n        }\n\n        if (sk.width !== this.pg.width || sk.height !== this.pg.height) {\n            this.pg.resizeCanvas(sk.width, sk.height);\n            this.doEndRect()\n        } else {\n            (this.pg as any)?.clear();\n        }\n        this.pg.background(0, 0, 0, 120)\n\n        if (!this.editingAnnotation) {\n            return\n        }\n        const annotation = this.editingAnnotation!\n        const startPoint = annotation.transformedStartPoint()\n        const endPoint = annotation.transformedEndPoint()\n        if (!startPoint || !endPoint) {\n            return\n        }\n        const startX = Math.min(startPoint[0], endPoint[0])\n        const startY = Math.min(startPoint[1], endPoint[1])\n        const endX = Math.max(startPoint[0], endPoint[0])\n        const endY = Math.max(startPoint[1], endPoint[1])\n\n        const position = getPointPosition(this.restorePoint([sk.mouseX, sk.mouseY]), annotation.startPoint, annotation.endPoint)\n        if (position === 'out-rect') {\n            sk.cursor(sk.CROSS)\n        } else {\n            sk.cursor(CursorStyleMapping[position])\n        }\n\n        this.pg.stroke(annotation.options.strokeColor!)\n        this.pg?.stroke(annotation.options.strokeColor!)\n        this.pg?.strokeWeight(1)\n        this.pg.fill(255, 255, 255, 255)\n        this.pg?.quad(\n            startX,\n            startY,\n            endX,\n            startY,\n            endX,\n            endY,\n            startX,\n            endY\n        )\n        this.drawCropArea(startX, startY, endX, endY)\n\n        const points = [\n            [startX, startY],\n            [startX, endY],\n            [endX, startY],\n            [endX, endY]\n        ]\n        this.pg?.fill(annotation.options.strokeColor!)\n        points.forEach(([x, y]) => {\n            this.pg?.quad(\n                x - offset / 2,\n                y - offset / 2,\n                x + offset / 2,\n                y - offset / 2,\n                x + offset / 2,\n                y + offset / 2,\n                x - offset / 2,\n                y + offset / 2\n            )\n        })\n\n        sk.image(this.pg as any, 0, 0, sk.width, sk.height)\n\n    }\n}\n\nexport default CropTool","/*\n * @Date: 2022-02-24 15:58:06\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-11-01 20:49:04\n * @Description: 放大镜🔍\n */\n\nimport P5BaseTool, { P5ToolAnnotation } from './baseTool/index'\nimport P5 from 'p5'\nimport { CursorPoint, distanceBetween } from '../utils/index'\n\nclass MagnifyTool extends P5BaseTool<any> {\n    static toolName = 'MagnifyTool'\n\n    public areaWidth = 50 // 需要放大的区域边长\n    public zoomScale = 2 // 放大倍数\n\n    constructor() {\n        super('MagnifyTool')\n    }\n\n    public draw(sk: P5): void {\n        if (this.editingAnnotation && this.loadedImage) {\n            const point = this.editingAnnotation.endPoint || this.editingAnnotation.startPoint\n            const transformedPoint = this.editingAnnotation.transformedEndPoint() || this.editingAnnotation.transformedStartPoint()\n            const radio = this.areaWidth / 2\n            const finalScale = this.scale * this.zoomScale\n            const finalRadio = this.areaWidth * finalScale / 2\n            const areaImg = this.loadedImage.get(point[0] - radio, point[1] - radio, this.areaWidth, this.areaWidth)\n            sk.image(\n                areaImg,\n                transformedPoint[0] - finalRadio,\n                transformedPoint[1] - finalRadio,\n                this.areaWidth * finalScale,\n                this.areaWidth * finalScale\n            )\n        }\n    }\n}\n\nexport default MagnifyTool","/*\n * @Date: 2022-03-01 13:16:30\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-11-01 16:42:33\n * @Description: file content\n */\nimport P5 from 'p5'\nimport P5BaseTool, { P5ToolAnnotation } from '../tools/baseTool'\nimport { CursorPoint } from '../../libs/utils'\nimport eventBus, { EMITTER_PLUGIN_ACTIVED } from '../utils/emitter'\n\nclass P5BasePlugin {\n    static readonly pluginName: string\n\n    public name: string = ''\n    public tools: P5BaseTool<P5ToolAnnotation>[] = []\n    public enabled: boolean = false\n    public active: boolean = false\n    private iconUrl?: string\n    public icon?: P5.Image\n    public totalPluginsCount: number = 0\n    public pluginIndex: number = 0\n\n    public pluginItemWH: number = 20\n    public pluginItemMargin: number = 5\n\n    public touchStartPoint?: CursorPoint\n    public touchEndPoint: CursorPoint = [0, 0]\n\n    public editingAnnotation?: P5ToolAnnotation\n    public pluginLayerOrigin?: CursorPoint\n\n    public scale: number = 1\n    public translateX: number = 0\n    public translateY: number = 0\n\n    constructor(imageUrl?: string) {\n        this.iconUrl = imageUrl\n        eventBus.on(EMITTER_PLUGIN_ACTIVED, (t: string) => {\n            if (t !== this.name) {\n                this.active = false\n            }\n        })\n    }\n\n    public preload(sk: P5) {\n        if (this.iconUrl) {\n            sk.loadImage(this.iconUrl, img => {\n                this.icon = img\n            })\n        }\n    }\n\n    /**\n     * @description: p5 draw\n     * @param {P5} sk\n     * @return {*}\n     */    \n     public draw(sk: P5): void {\n         if (!this.enabled) {\n             return\n         }\n        for (const tool of this.tools) {\n            for (const anno of tool.annotations) {\n                if (tool.pointInAnnotation([sk.mouseX, sk.mouseY], anno)) {\n                    if (!anno.startPoint) {\n                        continue\n                    }\n                    this.pluginLayerOrigin = tool.getPluginOrigin(anno)\n                    const x = this.pluginLayerOrigin[0] + (this.pluginItemWH + this.pluginItemMargin) * this.pluginIndex\n\n                    sk.noStroke()\n                    sk.fill('#ffffff')\n                    sk.rect(\n                        x,\n                        this.pluginLayerOrigin[1],\n                        this.pluginItemWH,\n                        this.pluginItemWH\n                    )\n                    sk.image(\n                        this.icon!,\n                        x,\n                        this.pluginLayerOrigin[1],\n                        this.pluginItemWH,\n                        this.pluginItemWH\n                    )\n                }\n            }\n        }\n    }\n\n    /**\n     * @description: p5 touchStarted\n     * @param {P5} sk\n     * @return {*}\n     */    \n    public touchStarted(sk: P5) {\n        for (const tool of this.tools) {\n            for (const anno of tool.annotations) {\n                const origin = tool.getPluginOrigin(anno)\n                const x = origin[0] + (this.pluginItemWH + this.pluginItemMargin) * this.pluginIndex\n                const y = origin[1]\n                if (\n                    sk.mouseX > x &&\n                    sk.mouseX < x + this.pluginItemWH &&\n                    sk.mouseY > y && \n                    sk.mouseY < y + this.pluginItemWH\n                ) {\n                    this.active = true\n                    this.editingAnnotation = anno\n                    const origin = tool.getPluginOrigin(anno)\n                    this.touchStartPoint = [\n                        sk.mouseX,\n                        sk.mouseY\n                    ]\n                    eventBus.emit(EMITTER_PLUGIN_ACTIVED, this.name)\n                    return\n                }\n            }\n        }\n    }\n\n    /**\n     * @description: p5 touchMoved\n     * @param {P5} sk\n     * @return {*}\n     */    \n    public touchMoved(sk: P5) {\n        this.touchEndPoint = [sk.mouseX, sk.mouseY]\n        this.handleTouchMoved(sk)\n    }\n\n    public touchEnded(sk: P5) {\n        this.active = false\n    }\n\n    /**\n     * @description: plugin实例类实现自身的touchMoved功能\n     * @param {*}\n     * @return {*}\n     */    \n    public handleTouchMoved(sk: P5) {\n\n    }\n}\n\nexport default P5BasePlugin\n","/*\n * @Date: 2022-03-01 13:27:23\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-03-05 17:29:20\n * @Description: file content\n */\n\nimport P5BasePlugin from \".\";\nimport P5 from 'p5'\n\nconst MovePng = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAARVJREFUSEvFlsENwjAMRX/lbegE3JiiEzCApQ4ADFDJM3DsFJy4cYRhkCxQqga1IU0MKCKnHhw/2/8naQXjatt2papHAHci2nZdd7NsrSxBY/IeQD3GX4mosUCygEhyX5MJkgQEya/TDsbvLCQJYOY9gB2AIZGqOgiIqFZVP7KDiLi46MoBNgA2RNS7eTPzw2URkWrsrgFwEpHTV4Bw0xRgMYeLmXWQqyoFYOZZt76AFyAQNDrXDGCml7fwAAjdsuTxFGAphxfLOyJpu5wGMUjFzGcAa6toH8ZdygOs83eVfzWi4iL7mRa1aQBZPP4/HTSLO3IaxHL897Irfl0Xf3AiFp6OOfuavV3XS0IXffQDC3/82/IEL+oxZnXZjqwAAAAASUVORK5CYII='\n\nclass MovePlugin extends P5BasePlugin {\n    constructor() {\n        super(MovePng)\n        this.name = 'MovePlugin'\n    }\n    \n    public handleTouchMoved(sk: P5): void {\n        if (!this.editingAnnotation) {\n            return\n        }\n        this.editingAnnotation.translateX = (this.touchEndPoint[0] - this.touchStartPoint![0]) / this.scale + this.editingAnnotation.translateX\n        this.editingAnnotation.translateY = (this.touchEndPoint[1] - this.touchStartPoint![1]) / this.scale + this.editingAnnotation.translateY\n        this.touchStartPoint = [sk.mouseX, sk.mouseY]\n    }\n}\n\nexport default MovePlugin\n","/*\n * @Date: 2022-03-01 13:27:23\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-03-05 17:28:54\n * @Description: file content\n */\n\nimport P5BasePlugin from \".\";\nimport P5 from 'p5'\n\nconst ZoomPng = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAATtJREFUSEvllT1OxDAQhZ/jG3AMKLeiS0cD7VacIRklB2BzgESTgoaeZltoqNhuT7AcgQaJGzhBjmJkjEHZSahwl8gz3/y9scIfH+X8Z1m2SpLkKsbr+37ftu2TJJYBQEQpgOffHDDzZzDHgBxgA+AmMKzc9xIZhIA3rXVa1/XLMdHG7sYyeAdwAuCgtV7PhYSASmu9NcZsAZwtAfkGYOZNWZanS0GiAFvLAFJZsKQfA6Aoisuu6x6sDpqmeXSORsgawI6Zd2KAxHCqjUg8U53be/8YMO6v1OrGF+M4GAc3MOISEZFbL18UT0R2adrlOYy2GPCTGBcDRMQ4ZGKMuV0kg0CMbnf5EzyvRL4n19jwPZnVg3GK/EfKNtY/18x8L24yEfVTnlgxIM/zC6XUeQTyysx37r8YMHUffQC+w6kZYxwPvQAAAABJRU5ErkJggg=='\n\nclass ScalePlugin extends P5BasePlugin {\n    constructor() {\n        super(ZoomPng)\n        this.name = 'ScalePlugin'\n    }\n    \n    public handleTouchMoved(sk: P5): void {\n        if (!this.editingAnnotation) {\n            return\n        }\n        const [endX, endY] = this.editingAnnotation.endPoint!\n        const [startX, startY] = this.editingAnnotation.startPoint!\n        const newX = endX + (this.touchEndPoint[0] - this.touchStartPoint![0]) / this.scale\n        let newY = endY + (this.touchEndPoint[1] - this.touchStartPoint![1]) / this.scale\n\n        if (this.editingAnnotation.belong === 'CircleTool') {\n            newY = startY\n        }\n\n        this.editingAnnotation.startPoint = [\n            Math.min(startX, newX),\n            Math.min(startY, newY)\n        ]\n        this.editingAnnotation.endPoint = [\n            Math.max(startX, newX),\n            Math.max(startY, newY)\n        ]\n        \n        this.touchStartPoint = [sk.mouseX, sk.mouseY]\n\n    }\n}\n\nexport default ScalePlugin\n","/*\n * @Date: 2022-02-24 15:58:06\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-11-01 22:28:05\n * @Description: 放大镜🔍\n */\n\nimport P5BaseTool, { P5ToolAnnotation } from './baseTool/index'\nimport P5 from 'p5'\nimport { CursorPoint, distanceBetween } from '../utils/index'\n\ninterface AngleToolAnnotation extends P5ToolAnnotation<'AngleTool'> {\n    points: [CursorPoint, CursorPoint?, CursorPoint?]\n}\n\nclass AngleTool extends P5BaseTool<AngleToolAnnotation> {\n    static toolName = 'AngleTool'\n\n    constructor(annotations?: AngleToolAnnotation[]) {\n        super('AngleTool', annotations)\n    }\n\n    private angleTransformPoint (anno: AngleToolAnnotation, point?: CursorPoint): CursorPoint | undefined {\n        if (!point) {\n            return undefined\n        }\n        return [\n            this.transformValue(point[0] + this.translateX) + anno.translateX,\n            this.transformValue(point[1] + this.translateY) + anno.translateY,\n        ]\n    }\n\n    // 覆盖父类行为\n    public touchStarted(sk: P5): void {\n        if (!this.editingAnnotation) {\n            this.editingAnnotation = {\n                ...this.getInitialAnnotation(),\n                belong: 'AngleTool',\n                points: [this.restorePoint([sk.mouseX, sk.mouseY])]\n            }\n            this.annotations.push(this.editingAnnotation)\n        }\n    }\n\n    private moved(sk: P5): void {\n        if (!this.editingAnnotation) {\n            return\n        }\n        if (this.editingAnnotation.points.length < 3) {\n            this.editingAnnotation.points[1] = this.restorePoint([sk.mouseX, sk.mouseY])\n        } else {\n            this.editingAnnotation.points[2] = this.restorePoint([sk.mouseX, sk.mouseY])\n        }\n    }\n\n    public mouseMoved(sk: P5): void {\n        this.moved(sk)\n    }\n    public touchMoved(sk: P5): void {\n        this.moved(sk)\n    }\n\n    public touchEnded(sk: P5): void {\n        if (!this.editingAnnotation) {\n            return\n        }\n        if (this.editingAnnotation.points.length === 2) {\n            this.editingAnnotation.points[2] = this.restorePoint([sk.mouseX, sk.mouseY])\n        } else if (this.editingAnnotation.points.length === 3) {\n            this.editingAnnotation = undefined\n        }\n    }\n\n    public draw(sk: P5): void {\n        for (const anno of this.annotations) {\n            const [point1, point2, point3] = anno.points\n            const [transformed1, transformed2, transformed3] = [\n                this.angleTransformPoint(anno, point1),\n                this.angleTransformPoint(anno, point2),\n                this.angleTransformPoint(anno, point3)\n            ]\n\n            super.configAnnotation(sk, anno)\n\n            if (transformed1 && transformed2) {\n                sk.line(\n                    transformed1[0],\n                    transformed1[1],\n                    transformed2[0],\n                    transformed2[1]\n                )\n            }\n\n            if (transformed2 && transformed3) {\n                sk.line(\n                    transformed2[0],\n                    transformed2[1],\n                    transformed3[0],\n                    transformed3[1]\n                )\n            }\n        }\n    }\n}\n\nexport default AngleTool","/*\n * @Date: 2022-02-24 17:10:02\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-11-01 22:07:42\n * @Description: file content\n */\n\nimport P5 from 'p5'\nimport P5BaseTool, { P5ToolAnnotation, P5ToolGetInfo } from '../tools/baseTool'\nimport CircleTool from '../tools/circleTool'\nimport SquareTool from '../tools/squareTool'\nimport LineTool from '../tools/lineTool'\nimport ArrowLineTool from '../tools/arrowLineTool'\nimport FreehandTool from '../tools/freehandTool'\nimport TextTool from '../tools/textTool'\nimport CropTool from '../tools/cropTool'\nimport MagnifyTool from '../tools/magnify'\n\nimport P5BasePlugin from '../plugins'\nimport MovePlugin from '../plugins/move'\nimport ScalePlugin from '../plugins/scale'\n\n\nimport type { P5ToolOptions } from '../tools/baseTool'\nimport _ from 'lodash'\nimport AngleTool from '../tools/angle'\n\ntype SKTouchStatus = 'start' | 'moving' | 'end'\n\nclass P5ToolsManager {\n    private tools: P5BaseTool<any>[] = []\n    private plugins: P5BasePlugin[] = []\n    /** mapping结构的tools，方便取值 */ \n    private _toolsMapping: Record<string, P5BaseTool<any>> = {}\n\n    public touchStatus: SKTouchStatus = 'end'\n    public hasEnabledToolCallback?: (has: boolean) => void\n    \n    /** 当前正在使用的工具 */\n    private _enabledTool?: P5BaseTool<any>\n\n    static CircleTool = CircleTool\n    static SquareTool = SquareTool\n    static LineTool = LineTool\n    static FreehandTool = FreehandTool\n    static TextTool = TextTool\n    static ArrowLineTool = ArrowLineTool\n    static AngleTool = AngleTool\n    static CropTool = CropTool\n    static MagnifyTool = MagnifyTool\n\n    static MovePlugin = MovePlugin\n    static ScalePlugin = ScalePlugin\n\n    constructor () {\n        this.tools = []\n        this._toolsMapping = {}\n    }\n\n    set enabledTool (tool: P5BaseTool<any> | undefined) {\n        this._enabledTool = tool\n        this.hasEnabledToolCallback?.(!!tool)\n        for (const plugin of this.plugins) {\n            plugin.enabled = !tool\n        }\n    }\n    get enabledTool () {\n        return this._enabledTool\n    }\n\n    /**\n     * @description: 添加tool\n     * @param {P5BaseTool} tool\n     * @return {*}\n     */    \n    public useTool(tool: P5BaseTool<any>, getToolInfo?: P5ToolGetInfo) {\n        const included = !!this.findTool(tool.name)\n        if (included) {\n            console.error('tool: %s已存在, 请勿重复添加')\n            return this\n        }\n        this._toolsMapping[tool.name] = tool\n        tool.getToolInfo = getToolInfo || tool.getToolInfo\n        this.tools.push(tool)\n\n        return this\n    }\n\n    /**\n     * @description: 删除tool\n     * @param {P5BaseTool} tool\n     * @return {*}\n     */    \n    public removeTool(tool?: P5BaseTool<any>) {\n        if (tool && this._toolsMapping[tool.name]) {\n            delete this._toolsMapping[tool.name]\n            const index = _.indexOf(this.tools, tool)\n            this.tools.splice(index, 1)\n        }\n        \n        return this\n    }\n\n    /**\n     * @description: 添加plugin\n     * @param {P5BasePlugin} plugin\n     * @param {P5BaseTool} controlTools\n     * @return {*}\n     */    \n     public usePlugin(plugin: P5BasePlugin, controlTools: P5BaseTool<any>[]) {\n         let flag = false\n         for (const plug of this.plugins) {\n             if (plugin.name === plug.name) {\n                 flag = true\n                 break\n             }\n         }\n        if (flag) {\n            console.error('%s已存在, 请勿重复添加', plugin.name)\n        } else {\n            plugin.tools = controlTools\n            this.plugins.push(plugin)\n        }\n        for (let i = 0; i < this.plugins.length; i ++) {\n            const plugin = this.plugins[i]\n            plugin.totalPluginsCount = this.plugins.length\n            plugin.pluginIndex = i\n        }\n        for (const tool of this.tools) {\n            tool.pluginsCount = this.plugins.length\n        }\n        \n        return this\n    }\n\n    /**\n     * @description: p5 setup\n     * @param {P5} sk\n     * @return {*}\n     */    \n    public setup(sk: P5) {\n        for (const tool of this.tools) {\n            tool.setup(sk)\n        }\n    }\n\n    /**\n     * @description: p5 preload\n     * @param {P5} sk\n     * @return {*}\n     */    \n    public preload(sk: P5) {\n        for (const tool of this.tools) {\n            tool.preload(sk)\n        }\n        for (const plugin of this.plugins) {\n            plugin.preload(sk)\n        }\n    }\n\n    /**\n     * @description: p5 draw\n     * @param {P5} sk\n     * @param {number} scale 坐标转换的scale值\n     * @param {number} translateX\n     * @param {number} translateY\n     * @return {*}\n     */    \n    public draw(sk: P5, scale?: number, translateX?: number, translateY?: number) {\n        for (const tool of this.tools) {\n            tool.scale = scale || 1\n            tool.translateX = translateX || 0\n            tool.translateY = translateY || 0\n            tool.draw(sk)\n        }\n        for (const plugin of this.plugins) {\n            plugin.scale = scale || 1\n            plugin.translateX = translateX || 0\n            plugin.translateY = translateY || 0\n            plugin.draw(sk)\n        }\n    }\n\n    /**\n     * @description: p5 mouseMoved\n     * @param {P5} sk\n     * @return {*}\n     */    \n    public mouseMoved(sk: P5) {\n        for (const tool of this.tools) {\n            tool.mouseMoved(sk)\n        }\n    }\n\n    /**\n     * @description: p5 touchStart\n     * @param {P5} sk\n     * @param {any} event\n     * @return {*}\n     */    \n    public touchStarted(sk: P5) {\n        this.touchStatus = 'start'\n        this.enabledTool?.touchStarted(sk)\n        for (const plugin of this.plugins) {\n            plugin.touchStarted(sk)\n        }\n    }\n\n    /**\n     * @description: p5 touchMoved\n     * @param {P5} sk\n     * @return {*}\n     */    \n    public touchMoved(sk: P5) {\n        this.touchStatus = 'moving'\n        this.enabledTool?.touchMoved(sk)\n        for (const plugin of this.plugins) {\n            if (plugin.active) {\n                plugin.touchMoved(sk)\n            }\n        }\n    }\n\n    /**\n     * @description: p5 touchEnd\n     * @param {P5} sk\n     * @return {*}\n     */    \n    public touchEnded(sk: P5) {\n        this.touchStatus = 'end'\n        this.enabledTool?.touchEnded(sk)\n        for (const plugin of this.plugins) {\n            if (plugin.active) {\n                plugin.touchEnded(sk)\n            }\n        }\n    }\n\n    /**\n     * @description: 根据名字获取对应工具\n     * @param {string} name\n     * @return {*}\n     */    \n    public findTool(name: string) {\n        return this._toolsMapping[name]\n    }\n\n    /**\n     * @description: 根据名字设置工具为可用状态\n     * @param {string} name\n     * @param {any} initialState\n     * @return {*}\n     */     \n    public setToolEnabled(name: string, options?: P5ToolOptions) {\n        const tool = this.findTool(name)\n        if (!tool) {\n            console.error('未设置tool：%s', name)\n        } else {\n            tool.options = options\n            this.enabledTool = tool\n        }\n    }\n\n    /**\n     * @description: 退出工具的使用\n     * @param {*}\n     * @return {*}\n     */    \n    public quitTool() {\n        this.enabledTool = undefined\n    }\n\n    /**\n     * @description: 获取所有标注\n     * @param {*}\n     * @return {*}\n     */    \n    public getAllAnnotations() {\n        let annotations: P5ToolAnnotation[] = []\n        for (const tool of this.tools) {\n            for (const anno of tool.annotations) {\n                annotations.push(anno)\n            }\n        }\n        return annotations\n    }\n    \n}\n\nexport default P5ToolsManager\n","/*\n * @Date: 2022-02-28 18:56:36\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-03-05 13:38:31\n * @Description: file content\n */\n\nimport { MouseEvent, useState } from \"react\"\nimport ReactDOM from \"react-dom\"\nimport './options.less'\nimport { CirclePicker } from 'react-color'\nimport 'react-color'\n\ntype Option = {\n    width: number\n    alpha: number\n    color: string\n}\nconst Options = (props: {\n    rect: DOMRect\n    onCancel: () => void\n    onConfirm: (values: Option) => void\n}) => {\n    const [width, setWidth] = useState('2')\n    const [alpha, setAlpha] = useState('1')\n    const [color, setColor] = useState<string>('#f44336')\n    return (\n        <div className=\"options\" style={{\n            top: props.rect.top,\n            left: props.rect.left - 290\n        }}>\n             <p>画笔粗细：</p>\n             <input value={width} onChange={e => setWidth(e.target.value)} />\n             <p>透明度：</p>\n             <input value={alpha} onChange={e => setAlpha(e.target.value)} />\n             <div>\n             <CirclePicker color={color} onChange={c => setColor(c.hex)} />\n             </div>\n\n             <div className=\"flex items-center mt-20px\">\n                 <button className=\"flex-1 mr-10px\" onClick={() => {\n                     props.onConfirm({\n                         width: parseFloat(width) || 2,\n                         alpha: parseFloat(alpha) || 1,\n                         color\n                     })\n                 }}>确认</button>\n                 <button className=\"flex-1\" onClick={props.onCancel}>取消</button>\n             </div>\n        </div>\n    )\n}\n\nconst chooseOptions = (e: MouseEvent): Promise<Option> => {\n    const rect = (e.target as HTMLParagraphElement).getBoundingClientRect()\n    return new Promise((resolve, reject) => {\n        let div = document.createElement('div')\n        div.style.position = 'fixed'\n        div.style.left = '0'\n        div.style.right = '0'\n        div.style.bottom = '0'\n        div.style.top = '0'\n        document.body.appendChild(div)\n\n        const close = () => {\n            ReactDOM.unmountComponentAtNode(div)\n            document.body.removeChild(div)\n            div = null as any\n        }\n\n        ReactDOM.render(\n            <Options\n                rect={rect}\n                onCancel={() => {\n                    close()\n                    reject()\n                }}\n                onConfirm={t => {\n                    close()\n                    resolve(t)\n                }}\n            />,\n            div\n        )\n    })\n}\n\nexport default chooseOptions\n","/*\n * @Date: 2022-02-28 18:56:36\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-03-05 13:38:41\n * @Description: file content\n */\n\nimport { MouseEvent, useState } from \"react\"\nimport ReactDOM from \"react-dom\"\nimport './options.less'\nimport 'react-color'\nimport { P5ToolBaseInfo } from \"libs/tools/baseTool\"\n\nconst InfoLayer = (props: {\n    info?: P5ToolBaseInfo\n    onCancel: () => void\n    onConfirm: (values: P5ToolBaseInfo) => void\n}) => {\n    const [info, setInfo] = useState<P5ToolBaseInfo | undefined>(props.info)\n\n    return (\n        <div className=\"w-250px bg-white flex flex-col p-20px children:(my-5px)\">\n             <p>标题: </p>\n             <input value={info?.title || ''} onChange={e => setInfo({\n                 ...info,\n                 title: e.target.value\n             })} />\n             <p>备注: </p>\n             <input value={info?.remark || ''} onChange={e => setInfo({\n                 ...info,\n                 remark: e.target.value\n             })} />\n             <p>其他信息: </p>\n             <input value={info?.others || ''} onChange={e => setInfo({\n                 ...info,\n                 others: e.target.value\n             })} />\n\n             <div className=\"flex items-center mt-20px\">\n                 <button className=\"flex-1 mr-10px\" onClick={() => {\n                     props.onConfirm({\n                         ...info,\n                         time: new Date().getTime()\n                     })\n                 }}>确认</button>\n                 <button className=\"flex-1\" onClick={props.onCancel}>取消</button>\n             </div>\n        </div>\n    )\n}\n\nconst editInfo = (info?: P5ToolBaseInfo): Promise<P5ToolBaseInfo | false> => {\n    return new Promise((resolve) => {\n        let div = document.createElement('div')\n        div.style.position = 'fixed'\n        div.style.left = '0'\n        div.style.right = '0'\n        div.style.bottom = '0'\n        div.style.top = '0'\n        div.style.display = 'flex'\n        div.style.alignItems = 'center'\n        div.style.justifyContent = 'center'\n        document.body.appendChild(div)\n\n        const close = () => {\n            ReactDOM.unmountComponentAtNode(div)\n            document.body.removeChild(div)\n            div = null as any\n        }\n\n        ReactDOM.render(\n            <InfoLayer\n                info={info}\n                onCancel={() => {\n                    close()\n                    resolve(false)\n                }}\n                onConfirm={t => {\n                    close()\n                    resolve(t)\n                }}\n            />,\n            div\n        )\n    })\n}\n\nexport default editInfo\n","/*\n * @Date: 2022-02-28 18:40:59\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-03-07 14:52:20\n * @Description: file content\n */\nimport { MouseEvent, useEffect, useState } from 'react'\nimport chooseOptions from './choose-options'\nimport './pannel.less'\nimport P5ToolsManager from '../../libs/manager'\nimport P5 from 'p5'\nimport emitter, { EMITTER_ANNOTATION_CROPPED, EMITTER_ANNOTATION_INFO_UPDATED } from '../../libs/utils/emitter'\nimport { P5ToolAnnotation, P5ToolBaseInfo } from 'libs/tools/baseTool'\nimport moment from 'moment'\nimport editInfo from './edit-info'\nimport CropTool from 'libs/tools/cropTool'\n\nconst Pannel = (props: {\n    manager: P5ToolsManager\n    sk?: P5,\n    onChangeDragging: () => void\n    dragging: boolean\n}) => {\n    const [showAnnotations, setShowAnnotations] = useState(true)\n    const [annotations, setAnnotations] = useState<P5ToolAnnotation[]>([])\n\n    const [showImages, setShowImages] = useState(false)\n    const [images, setImages] = useState<{\n        info: P5ToolBaseInfo,\n        url: string\n    }[]>([])\n\n    const sortFunc = (a: any, b: any) => {\n        const aTime = moment(a.info.time)\n        const bTime = moment(b.info.time)\n        if (aTime.isAfter(bTime)) {\n            return -1\n        } else {\n            return 1\n        }\n    }\n\n    const getAnnotations = () => {\n        const temp = props.manager\n            .getAllAnnotations()\n            .sort(sortFunc)\n        setAnnotations(temp)\n    }\n    const getImages = () => {\n        const cropTool = props.manager.findTool(P5ToolsManager.CropTool.toolName) as CropTool\n        const temp = cropTool.images.sort(sortFunc)\n        setImages([...temp])\n    }\n\n    useEffect(() => {\n        emitter.on(EMITTER_ANNOTATION_INFO_UPDATED, getAnnotations)\n        emitter.on(EMITTER_ANNOTATION_CROPPED, getImages)\n        return () => {\n            emitter.removeListener(EMITTER_ANNOTATION_INFO_UPDATED, getAnnotations)\n            emitter.removeListener(EMITTER_ANNOTATION_CROPPED, getImages)\n        }\n    }, [])\n\n    const selectTool = async (e: MouseEvent, toolName: string) => {\n        try {\n            const option = await chooseOptions(e)\n            props.sk?.cursor(props.sk.ARROW)\n\n            if (toolName === P5ToolsManager.TextTool.toolName) {\n                props.manager.setToolEnabled(toolName, {\n                    fillColor: option.color,\n                    strokeAlpha: option.alpha,\n                    textSize: option.width\n                })\n            } else {\n                props.manager.setToolEnabled(toolName, {\n                    strokeColor: option.color,\n                    strokeAlpha: option.alpha,\n                    strokeWeight: option.width\n                })\n            }\n        } catch (e) {\n            props.manager.quitTool()\n        }\n\n    }\n\n    const doCrop = () => {\n        props.sk?.cursor(props.sk.CROSS)\n\n        props.manager.setToolEnabled(P5ToolsManager.CropTool.toolName, {\n            strokeColor: 'blue'\n        })\n    }\n\n    const doEdit = async (anno: P5ToolAnnotation) => {\n        const info = await editInfo(anno.info)\n        if (info) {\n            anno.info = info\n            getAnnotations()\n        }\n    }\n\n    const doDelete = (anno: P5ToolAnnotation) => {\n        anno.remove()\n        getAnnotations()\n    }\n\n    const deleteImage = (img: {\n        info: P5ToolBaseInfo,\n        url: string\n    }) => {\n        const cropTool = props.manager.findTool(P5ToolsManager.CropTool.toolName) as CropTool\n        const index = cropTool.images.indexOf(img)\n        cropTool.images.splice(index, 1)\n        getImages()\n    }\n\n    return (\n        <>\n            <div className=\"common-pannel pannel\">\n                <p onClick={e => selectTool(e, P5ToolsManager.CircleTool.toolName)}>圆形</p>\n                <p onClick={e => selectTool(e, P5ToolsManager.SquareTool.toolName)}>方形</p>\n                <p onClick={e => selectTool(e, P5ToolsManager.TextTool.toolName)}>文字</p>\n                <p onClick={e => selectTool(e, P5ToolsManager.LineTool.toolName)}>直线</p>\n                <p onClick={e => selectTool(e, P5ToolsManager.ArrowLineTool.toolName)}>箭头</p>\n\n                <p onClick={e => selectTool(e, P5ToolsManager.FreehandTool.toolName)}>freehand</p>\n                <p onClick={e => doCrop()}>裁剪</p>\n                <p onClick={e => {\n                    if (!showAnnotations) {\n                        setShowImages(false)\n                    }\n                    setShowAnnotations(!showAnnotations)\n                }}>{showAnnotations ? '隐藏标注' : '显示标注'}</p>\n                <p onClick={e => {\n                    if (!showImages) {\n                        setShowAnnotations(false)\n                    }\n                    setShowImages(!showImages)\n                }}>{showImages ? '隐藏截图' : '显示截图'}</p>\n                <p onClick={e => props.onChangeDragging()}>{props.dragging ? '取消拖动' : '拖动'}</p>\n\n            </div>\n            {\n                showAnnotations && <div className='common-pannel annotations-layer'>\n                    <div className='title outer sticky top-0 bg-white'>\n                        标注信息\n                    </div>\n                    {\n                        annotations.map(anno => {\n                            if (anno.belong === P5ToolsManager.CropTool.toolName) {\n                                return null\n                            }\n                            return (\n                                <div key={`annotation-${anno.info.time}`} className='items-center outer'>\n                                    <span className='text-15px font-500'>{anno.belong}</span>\n                                    <div className='flex flex-col space-y-5px !py-5px flex-1 !mx-15px w-0'>\n                                        <span>标题: {anno.info.title}</span>\n                                        <span>备注: {anno.info.remark}</span>\n                                        <span>其他信息: {anno.info.others}</span>\n                                        <span>时间: {moment(anno.info.time).format('DD HH:mm:ss')}</span>\n                                    </div>\n\n                                    <div className='flex flex-col space-y-10px children:(h-25px)'>\n                                        <button onClick={() => doEdit(anno)}>编辑</button>\n                                        <button onClick={() => doDelete(anno)}>删除</button>\n                                    </div>\n                                </div>\n                            )\n                        })\n                    }\n                </div>\n            }\n            {\n                showImages && (\n                    <div className='common-pannel images-layer'>\n                        <div className='title outer sticky top-0 bg-white'>\n                            截图\n                        </div>\n                        {\n                            images.map((img, index) => (<div className='flex flex-col space-y-5px outer' key={`image-${img.info.time}`}>\n                                <span className='font-500 text-15px'>标题: {img.info.title}</span>\n                                <span>时间: {moment(img.info.time).format('YYYY-MM-DD HH:mm')}</span>\n                                <div className='flex items-center !mx-0 !py-0'>\n                                    <img className='flex-1 w-0 mr-10px' src={img.url} />\n                                    <button onClick={() => deleteImage(img)}>删除</button>\n                                </div>\n                            </div>))\n                        }\n                    </div>\n                )\n            }\n        </>\n    )\n}\n\nexport default Pannel\n","/*\n * @Date: 2022-02-28 15:12:47\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-03-10 22:48:28\n * @Description: file content\n */\nimport { useCallback, useEffect, useMemo, useRef, useState, WheelEvent } from 'react'\nimport './app.less'\nimport P5 from 'p5'\nimport P5ToolsManager from '../libs/manager'\nimport Pannel from './components/pannel'\nimport { CursorPoint } from '../libs/utils'\nimport CropTool from 'libs/tools/cropTool'\nimport { createPortal, render, unmountComponentAtNode } from 'react-dom'\nimport P5BaseTool, { P5ToolGetInfo } from '../libs/tools/baseTool'\nimport moment from 'moment'\nimport editInfo from './components/edit-info'\nimport _ from 'lodash'\n\nfunction App() {\n    const p5ref = useRef<HTMLDivElement>(null!)\n    const [image, setImage] = useState<P5.Image>()\n    const [sk, setSk] = useState<P5>()\n    const [wrapper, setWrapper] = useState<P5.Element>()\n    const [scale, setScale] = useState(1)\n    const [dragging, setDragging] = useState(false)\n    const [translate, setTranslate] = useState({\n        x: 0,\n        y: 0\n    })\n\n    const [cropLayerPosition, setCropLayerPosition] = useState<CursorPoint>()\n\n    const textTool = new P5ToolsManager.TextTool()\n    const circleTool = new P5ToolsManager.CircleTool()\n    const squareTool = new P5ToolsManager.SquareTool()\n    const lineTool = new P5ToolsManager.LineTool()\n    const freehandTool = new P5ToolsManager.FreehandTool()\n    const arrowLineTool = new P5ToolsManager.ArrowLineTool()\n    const cropTool = new P5ToolsManager.CropTool()\n\n    cropTool.startRect = (p) => {\n        setCropLayerPosition(undefined)\n    }\n    cropTool.endRect = (p) => {\n        setCropLayerPosition([p.startX, p.startY])\n    }\n\n    const getInfo: P5ToolGetInfo = async (tool: P5BaseTool<any>) => {\n        const info = await editInfo()\n        if (info) {\n\n        } else {\n            _.last(tool.annotations).remove()\n        }\n        return {\n            ...info,\n            time: new Date().getTime()\n        }\n    }\n\n    const [toolsManager] = useState<P5ToolsManager>(() => {\n        const toolsManager = new P5ToolsManager()\n        toolsManager\n            .useTool(textTool, getInfo)\n            .useTool(circleTool, getInfo)\n            .useTool(squareTool, getInfo)\n            .useTool(lineTool, getInfo)\n            .useTool(freehandTool, getInfo)\n            .useTool(arrowLineTool, getInfo)\n            .useTool(cropTool, getInfo)\n        toolsManager\n            .usePlugin(new P5ToolsManager.MovePlugin(), [circleTool, squareTool, textTool])\n            .usePlugin(new P5ToolsManager.ScalePlugin(), [squareTool, circleTool])\n        return toolsManager\n    })\n\n    useEffect(() => {\n        if (sk) {\n            const wrap = sk.createDiv()\n            wrap.addClass('w-130px h-50px')\n            // document.getElementById().appendChild(wrap.elt)\n            render(\n                <>\n                    <button className='mr-10px w-50px h-30px' onClick={e => {\n                        doCrop(e)\n                    }}>确认</button>\n                    <button className='w-50px h-30px' onClick={doCancel}>取消</button>\n                </>,\n                wrap.elt\n            )\n\n            setWrapper(wrap)\n        }\n    }, [sk])\n\n    useEffect(() => {\n        if (!wrapper) {\n            return\n        }\n        if (cropLayerPosition) {\n            wrapper.position(cropLayerPosition[0], cropLayerPosition[1] - 35)\n            wrapper.show()\n        } else {\n            wrapper.hide()\n        }\n    }, [cropLayerPosition, wrapper])\n\n    const draw = useCallback(() => {\n        if (!sk || !image) {\n            return\n        }\n        (sk as any).clear();\n        sk.resizeCanvas(image.width * scale, image.height * scale, false)\n        sk.image(image, translate.x, translate.y, image.width * scale, image.height * scale)\n        toolsManager.draw(sk!, scale, translate.x, translate.y)\n    }, [scale, sk, image, translate])\n\n    useEffect(() => {\n        if (sk && image) {\n            sk.draw = draw\n            sk.touchStarted = (event: any) => {\n                if (event.target.nodeName === 'CANVAS') {\n                    if (!dragging) {\n                        toolsManager.touchStarted(sk)\n                    }\n                }\n            }\n            sk.touchMoved = (event: any) => {\n                if (!dragging) {\n                    toolsManager.touchMoved(sk)\n                } else {\n                    setTranslate({\n                        x: translate.x + sk.mouseX - sk.pmouseX,\n                        y: translate.y + sk.mouseY - sk.pmouseY\n                    })\n                }\n            }\n            sk.touchEnded = () => {\n                if (!dragging) {\n                    toolsManager.touchEnded(sk)\n                    if (toolsManager.enabledTool?.name !== P5ToolsManager.CropTool.toolName) {\n                        toolsManager.quitTool()\n                    }\n                }\n            }\n\n            sk.setup = () => {\n                const viewerSize = {\n                    x: 0,\n                    y: 0\n                }\n                sk.createCanvas(viewerSize.x, viewerSize.y)\n                toolsManager.setup(sk)\n            }\n\n\n            sk.mouseWheel = (event: any) => {\n                if (event.target.nodeName === 'CANVAS') {\n                    const temp = scale - event.deltaY / 100\n                    setScale(Math.max(Math.min(temp, 5), 0.5))\n                }\n            }\n        }\n    }, [sk, image, draw, dragging])\n\n    useEffect(() => {\n        if (p5ref.current) {\n            new P5((sk: P5) => {\n                setSk(sk)\n                sk.preload = () => {\n                    sk.loadImage('https://picsum.photos/1200/600', t => {\n                        setImage(t)\n                    })\n                    toolsManager.preload(sk)\n                }\n\n            }, p5ref.current)\n        }\n    }, [])\n\n    const doCancel = (e: any) => {\n        setCropLayerPosition(undefined)\n        const cropTool = toolsManager?.findTool(P5ToolsManager.CropTool.toolName) as CropTool\n        cropTool.endCrop()\n    }\n\n    const doCrop = (e: any) => {\n        setCropLayerPosition(undefined)\n        const cropTool = toolsManager?.findTool(P5ToolsManager.CropTool.toolName) as CropTool\n        cropTool.doCrop(sk!)\n    }\n\n    return (\n        <div className='relative flex items-center justify-center w-screen h-screen overflow-hidden' id='test'>\n            <div ref={p5ref} className='absolute left-0 right-0 top-0 bottom-0' />\n            <Pannel manager={toolsManager} sk={sk} onChangeDragging={() => setDragging(!dragging)} dragging={dragging} />\n        </div>\n    )\n}\n\nexport default App\n","/*\n * @Date: 2022-02-28 15:12:47\n * @Author: wang0122xl@163.com\n * @LastEditors: wang0122xl@163.com\n * @LastEditTime: 2022-03-04 14:38:31\n * @Description: file content\n */\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\nimport 'virtual:windi.css'\n\nReactDOM.render(\n    <React.StrictMode>\n        <App />\n    </React.StrictMode>,\n    document.getElementById('root')\n)\n"],"names":["EventEmitter","Options","props","width","setWidth","useState","alpha","setAlpha","color","setColor","top","rect","left","e","target","value","c","hex","onConfirm","parseFloat","onCancel","chooseOptions","getBoundingClientRect","Promise","resolve","reject","div","document","createElement","style","position","right","bottom","body","appendChild","close","unmountComponentAtNode","removeChild","render","t","InfoLayer","info","setInfo","title","remark","others","time","Date","getTime","editInfo","display","alignItems","justifyContent","Pannel","showAnnotations","setShowAnnotations","annotations","setAnnotations","showImages","setShowImages","images","setImages","sortFunc","a","b","aTime","moment","bTime","isAfter","getAnnotations","temp","manager","getAllAnnotations","sort","getImages","cropTool","findTool","P5ToolsManager","CropTool","toolName","on","EMITTER_ANNOTATION_INFO_UPDATED","EMITTER_ANNOTATION_CROPPED","removeListener","selectTool","option","sk","cursor","ARROW","TextTool","setToolEnabled","fillColor","strokeAlpha","textSize","strokeColor","strokeWeight","quitTool","doCrop","CROSS","doEdit","anno","doDelete","remove","deleteImage","img","index","indexOf","splice","CircleTool","SquareTool","LineTool","ArrowLineTool","FreehandTool","onChangeDragging","dragging","map","belong","format","url","p5ref","useRef","image","setImage","setSk","wrapper","setWrapper","scale","setScale","setDragging","translate","setTranslate","x","y","cropLayerPosition","setCropLayerPosition","textTool","circleTool","squareTool","lineTool","freehandTool","arrowLineTool","startRect","p","undefined","endRect","startX","startY","getInfo","tool","last","toolsManager","useTool","usePlugin","MovePlugin","ScalePlugin","wrap","createDiv","addClass","doCancel","elt","show","hide","draw","useCallback","clear","resizeCanvas","height","touchStarted","event","nodeName","touchMoved","mouseX","pmouseX","mouseY","pmouseY","touchEnded","enabledTool","name","setup","viewerSize","createCanvas","mouseWheel","deltaY","Math","max","min","current","P5","preload","loadImage","endCrop","ReactDOM","getElementById"],"mappings":"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"}